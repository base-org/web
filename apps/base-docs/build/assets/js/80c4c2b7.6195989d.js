"use strict";(self.webpackChunk_app_base_docs=self.webpackChunk_app_base_docs||[]).push([[6596],{82247:(e,t,n)=>{n.d(t,{xA:()=>d,yg:()=>y});var a=n(14041);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),g=p(n),m=o,y=g["".concat(l,".").concat(m)]||g[m]||c[m]||r;return n?a.createElement(y,i(i({ref:t},d),{},{components:n})):a.createElement(y,i({ref:t},d))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[g]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},48128:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(89575),o=(n(14041),n(82247));const r={title:"Sending messages from Base to other chains using LayerZero V2",slug:"/cross-chain-with-layerzero",description:"A tutorial that teaches how to use LayerZero V2 to perform cross-chain messaging from Base Goerli testnet to Optimism Goerli testnet.",author:"taycaldwell",eywords:["Cross-chain","Omni-chain","Crosschain","OmniChain","LayerZero","LayerZero V2","lz","cross-chain messaging","transfer tokens across chains"],tags:["cross-chain"],difficulty:"intermediate",displayed_sidebar:null},i=void 0,s={unversionedId:"docs/cross-chain-with-layerzero",id:"docs/cross-chain-with-layerzero",title:"Sending messages from Base to other chains using LayerZero V2",description:"A tutorial that teaches how to use LayerZero V2 to perform cross-chain messaging from Base Goerli testnet to Optimism Goerli testnet.",source:"@site/tutorials/docs/2_cross-chain-with-layerzero.md",sourceDirName:"docs",slug:"/cross-chain-with-layerzero",permalink:"/tutorials/cross-chain-with-layerzero",draft:!1,tags:[{label:"cross-chain",permalink:"/tutorials/tags/cross-chain"}],version:"current",sidebarPosition:2,frontMatter:{title:"Sending messages from Base to other chains using LayerZero V2",slug:"/cross-chain-with-layerzero",description:"A tutorial that teaches how to use LayerZero V2 to perform cross-chain messaging from Base Goerli testnet to Optimism Goerli testnet.",author:"taycaldwell",eywords:["Cross-chain","Omni-chain","Crosschain","OmniChain","LayerZero","LayerZero V2","lz","cross-chain messaging","transfer tokens across chains"],tags:["cross-chain"],difficulty:"intermediate",displayed_sidebar:null}},l={},p=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Foundry",id:"foundry",level:3},{value:"Coinbase Wallet",id:"coinbase-wallet",level:3},{value:"Wallet funds",id:"wallet-funds",level:3},{value:"What is LayerZero?",id:"what-is-layerzero",level:2},{value:"High-level concepts",id:"high-level-concepts",level:3},{value:"Endpoints",id:"endpoints",level:4},{value:"Security Stack (DVNs)",id:"security-stack-dvns",level:4},{value:"Executors",id:"executors",level:4},{value:"Creating a project",id:"creating-a-project",level:2},{value:"Installing the LayerZero smart contracts",id:"installing-the-layerzero-smart-contracts",level:2},{value:"Getting started with LayerZero",id:"getting-started-with-layerzero",level:2},{value:"Writing the smart contract",id:"writing-the-smart-contract",level:2},{value:"Implementing message sending (<code>_lzSend</code>)",id:"implementing-message-sending-_lzsend",level:3},{value:"Implementing gas fee estimation (<code>_quote</code>)",id:"implementing-gas-fee-estimation-_quote",level:3},{value:"Implementing message receiving (<code>_lzReceive</code>)",id:"implementing-message-receiving-_lzreceive",level:3},{value:"Final code",id:"final-code",level:3},{value:"Compiling the smart contract",id:"compiling-the-smart-contract",level:2},{value:"Deploying the smart contract",id:"deploying-the-smart-contract",level:2},{value:"Setting up your wallet as the deployer",id:"setting-up-your-wallet-as-the-deployer",level:3},{value:"Setting up environment variables",id:"setting-up-environment-variables",level:3},{value:"Deploying the smart contract to Base Goerli",id:"deploying-the-smart-contract-to-base-goerli",level:3},{value:"Deploying the smart contract to Optimism Goerli",id:"deploying-the-smart-contract-to-optimism-goerli",level:3},{value:"Opening the messaging channels",id:"opening-the-messaging-channels",level:2},{value:"Setting the peers",id:"setting-the-peers",level:3},{value:"Sending messages",id:"sending-messages",level:2},{value:"Building message options",id:"building-message-options",level:3},{value:"Estimating the gas fee",id:"estimating-the-gas-fee",level:3},{value:"Sending the message",id:"sending-the-message",level:3},{value:"Receiving the message",id:"receiving-the-message",level:3},{value:"Conclusion",id:"conclusion",level:2}],d={toc:p},g="wrapper";function c(e){let{components:t,...n}=e;return(0,o.yg)(g,(0,a.A)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"This tutorial will guide you through the process of sending cross-chain message data from a Base smart contract to another smart contract on a different chain using LayerZero V2."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"objectives"},"Objectives"),(0,o.yg)("p",null,"By the end of this tutorial you should be able to do the following:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Set up a smart contract project for Base using Foundry"),(0,o.yg)("li",{parentName:"ul"},"Install the LayerZero smart contracts as a dependency"),(0,o.yg)("li",{parentName:"ul"},"Use LayerZero to send messages and from smart contracts on Base to smart contracts on different chains"),(0,o.yg)("li",{parentName:"ul"},"Deploy and test your smart contracts on Base testnet")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.yg)("h3",{id:"foundry"},"Foundry"),(0,o.yg)("p",null,"This tutorial requires you to have Foundry installed."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"From the command-line (terminal), run: ",(0,o.yg)("inlineCode",{parentName:"li"},"curl -L https://foundry.paradigm.xyz | bash")),(0,o.yg)("li",{parentName:"ul"},"Then run ",(0,o.yg)("inlineCode",{parentName:"li"},"foundryup"),", to install the latest (nightly) build of Foundry")),(0,o.yg)("p",null,"For more information, see the Foundry Book ",(0,o.yg)("a",{parentName:"p",href:"https://book.getfoundry.sh/getting-started/installation"},"installation guide"),"."),(0,o.yg)("h3",{id:"coinbase-wallet"},"Coinbase Wallet"),(0,o.yg)("p",null,"In order to deploy a smart contract, you will first need a wallet. You can create a wallet by downloading the Coinbase Wallet browser extension."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"Download ",(0,o.yg)("a",{parentName:"li",href:"https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddgcijnmhnfnkdnaad?hl=en"},"Coinbase Wallet"))),(0,o.yg)("h3",{id:"wallet-funds"},"Wallet funds"),(0,o.yg)("p",null,"To complete this tutorial, you will need to fund a wallet with ETH on Base Goerli and Optimism Goerli."),(0,o.yg)("p",null,"The ETH is required for covering gas fees associated with deploying smart contracts to each network."),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},"To fund your wallet with ETH on Base Goerli, visit a faucet listed on the ",(0,o.yg)("a",{parentName:"li",href:"https://docs.base.org/tools/network-faucets"},"Base Faucets")," page."),(0,o.yg)("li",{parentName:"ul"},"To fund your wallet with ETH on Optimism Goerli, visit a faucet listed on the ",(0,o.yg)("a",{parentName:"li",href:"https://docs.optimism.io/builders/tools/faucets"},"Optimism Faucets")," page.")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"what-is-layerzero"},"What is LayerZero?"),(0,o.yg)("p",null,'LayerZero is an interoperability protocol that allows developers to build applications (and tokens) that can connect to multiple blockchains. LayerZero defines these types of applications as "omnichain" applications.'),(0,o.yg)("p",null,"The LayerZero protocol is made up of immutable on-chain ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/layerzero-endpoint"},"Endpoints"),", a configurable ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/decentralized-verifier-networks"},"Security Stack"),", and a permissionless set of ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/executors"},"Executors")," that transfer messages between chains."),(0,o.yg)("h3",{id:"high-level-concepts"},"High-level concepts"),(0,o.yg)("h4",{id:"endpoints"},"Endpoints"),(0,o.yg)("p",null,"Endpoints are immutable LayerZero smart contracts that implement a standardized interface for your own smart contracts to use and in order to manage security configurations and send and receive messages."),(0,o.yg)("h4",{id:"security-stack-dvns"},"Security Stack (DVNs)"),(0,o.yg)("p",null,"The ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/decentralized-verifier-networks"},"Security Stack")," is a configurable set of required and optional Decentralized Verifier Networks (DVNs). The DVNs are used to verify message payloads to ensure integrity of your application's messages."),(0,o.yg)("h4",{id:"executors"},"Executors"),(0,o.yg)("p",null,(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/executors"},"Executors")," are responsible for initiating message delivery. They will automatically execute the ",(0,o.yg)("inlineCode",{parentName:"p"},"lzReceive")," function of the endpoint on the destination chain once a message has been verified by the Security Stack."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"creating-a-project"},"Creating a project"),(0,o.yg)("p",null,"Before you begin, you need to set up your smart contract development environment by creating a Foundry project."),(0,o.yg)("p",null,"To create a new Foundry project, first create a new directory:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"mkdir myproject\n")),(0,o.yg)("p",null,"Then run:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cd myproject\nforge init\n")),(0,o.yg)("p",null,"This will create a Foundry project with the following basic layout:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 foundry.toml\n\u251c\u2500\u2500 script\n\u251c\u2500\u2500 src\n\u2514\u2500\u2500 test\n")),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"You can delete the ",(0,o.yg)("inlineCode",{parentName:"p"},"src/Counter.sol"),", ",(0,o.yg)("inlineCode",{parentName:"p"},"test/Counter.t.sol"),", and ",(0,o.yg)("inlineCode",{parentName:"p"},"script/Counter.s.sol")," boilerplate files that were generated with the project, as you will not be needing them.")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"installing-the-layerzero-smart-contracts"},"Installing the LayerZero smart contracts"),(0,o.yg)("p",null,"To use LayerZero within your Foundry project, you need to install the LayerZero smart contracts and their dependencies using ",(0,o.yg)("inlineCode",{parentName:"p"},"forge install"),"."),(0,o.yg)("p",null,"To install LayerZero smart contracts and their dependencies, run the following commands:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"forge install GNSPS/solidity-bytes-utils --no-commit\nforge install OpenZeppelin/openzeppelin-contracts@v4.9.4 --no-commit\nforge install LayerZero-Labs/LayerZero-v2 --no-commit\n")),(0,o.yg)("p",null,"Once installed, update your ",(0,o.yg)("inlineCode",{parentName:"p"},"foundry.toml")," file by appending the following lines:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"remappings = [\n    '@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts',\n    'solidity-bytes-utils/=lib/solidity-bytes-utils',\n    '@layerzerolabs/lz-evm-oapp-v2/=lib/LayerZero-v2/oapp',\n    '@layerzerolabs/lz-evm-protocol-v2/=lib/LayerZero-v2/protocol',\n    '@layerzerolabs/lz-evm-messagelib-v2/=lib/LayerZero-v2/messagelib',\n]\n\n")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"getting-started-with-layerzero"},"Getting started with LayerZero"),(0,o.yg)("p",null,"LayerZero provides a smart contract standard called ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oapp"},"OApp")," that is intended for omnichain messaging and configuration."),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\nimport { OAppSender } from "./OAppSender.sol";\nimport { OAppReceiver, Origin } from "./OAppReceiver.sol";\nimport { OAppCore } from "./OAppCore.sol";\n\nabstract contract OApp is OAppSender, OAppReceiver {\n   constructor(address _endpoint) OAppCore(_endpoint, msg.sender) {}\n\n   function oAppVersion() public pure virtual returns (uint64 senderVersion, uint64 receiverVersion) {\n       senderVersion = SENDER_VERSION;\n       receiverVersion = RECEIVER_VERSION;\n   }\n}\n')),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"You can view the source code for this contract on ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/LayerZero-Labs/LayerZero-v2/blob/main/oapp/contracts/oapp/OApp.sol"},"GitHub"),".")),(0,o.yg)("p",null,"To get started using LayerZero, developers simply need to inherit from the ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/LayerZero-Labs/LayerZero-v2/blob/main/oapp/contracts/oapp/OApp.sol"},"OApp")," contract, and implement the following two inherited functions:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"_lzSend"),": A function used to send an omnichain message"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"_lzReceive"),": A function used to receive an omnichain message")),(0,o.yg)("p",null,"In this tutorial, you will be implementing the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oapp"},"OApp")," standard into your own project to add the capability to send messages from a smart contract on Base to a smart contract on Optimism."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"An extension of the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oapp"},"OApp")," contract standard known as ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oft"},"OFT")," is also available for supporting omnichain fungible token transfers.")),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"For more information on transferring tokens across chains using LayerZero, visit the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oft"},"LayerZero documentation"),".")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"writing-the-smart-contract"},"Writing the smart contract"),(0,o.yg)("p",null,"To get started, create a new Solidity smart contract file in your project's ",(0,o.yg)("inlineCode",{parentName:"p"},"src/")," directory named ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract.sol"),", and add the following content:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\nimport { OApp, Origin, MessagingFee } from "@layerzerolabs/lz-evm-oapp-v2/contracts/oapp/OApp.sol";\n\ncontract ExampleContract is OApp {\n   constructor(address _endpoint, address _owner) OApp(_endpoint, _owner) {}\n}\n')),(0,o.yg)("p",null,"The code snippet above defines a new smart contract named ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," that extends the ",(0,o.yg)("inlineCode",{parentName:"p"},"OApp")," contract standard."),(0,o.yg)("p",null,"The contract's constructor expects two arguments:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"_endpoint"),": The ",(0,o.yg)("a",{parentName:"li",href:"https://docs.layerzero.network/explore/layerzero-endpoint"},"LayerZero Endpoint")," ",(0,o.yg)("inlineCode",{parentName:"li"},"address")," for the chain the smart contract is deployed to."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"_owner"),": The ",(0,o.yg)("inlineCode",{parentName:"li"},"address")," of the owner of the smart contract.")),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/layerzero-endpoint"},"LayerZero Endpoints")," are smart contracts that expose an interface for OApp contracts to manage security configurations and send and receive messages via the LayerZero protocol.")),(0,o.yg)("h3",{id:"implementing-message-sending-_lzsend"},"Implementing message sending (",(0,o.yg)("inlineCode",{parentName:"h3"},"_lzSend"),")"),(0,o.yg)("p",null,"To send messages to another chain, your smart contract must call the ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzSend")," function inherited from the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oapp"},"OApp")," contract."),(0,o.yg)("p",null,"Add a new custom function named ",(0,o.yg)("inlineCode",{parentName:"p"},"sendMessage")," to your smart contract that has the following content:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},"/// @notice Sends a message from the source chain to the destination chain.\n/// @param _dstEid The endpoint ID of the destination chain.\n/// @param _message The message to be sent.\n/// @param _options The message execution options (e.g. gas to use on destination).\nfunction sendMessage(uint32 _dstEid, string memory _message, bytes calldata _options) external payable {\n   bytes memory _payload = abi.encode(_message); // Encode the message as bytes\n   _lzSend(\n       _dstEid,\n       _payload,\n       _options,\n       MessagingFee(msg.value, 0), // Fee for the message (nativeFee, lzTokenFee)\n       payable(msg.sender) // The refund address in case the send call reverts\n   );\n}\n")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"sendMessage")," function above calls the inherited ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzSend")," function, while passing in the following expected data:"),(0,o.yg)("table",null,(0,o.yg)("thead",{parentName:"table"},(0,o.yg)("tr",{parentName:"thead"},(0,o.yg)("th",{parentName:"tr",align:"left"},"Name"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Description"))),(0,o.yg)("tbody",{parentName:"table"},(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_dstEid")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"uint32")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The ",(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/contracts/endpoint-addresses"},"endpoint ID")," of the destination chain to send the message to.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_payload")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The message (encoded) to send.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_options")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/contracts/options"},"Additional options")," when sending the message, such as how much gas should be used when receiving the message.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_fee")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("a",{parentName:"td",href:"https://github.com/LayerZero-Labs/LayerZero-v2/blob/c3213200dfe8fabbf7d92c685590d34e6e70da43/protocol/contracts/interfaces/ILayerZeroEndpointV2.sol#L24"},(0,o.yg)("inlineCode",{parentName:"a"},"MessagingFee"))),(0,o.yg)("td",{parentName:"tr",align:"left"},"The calculated fee for sending the message.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_refundAddress")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"address")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The ",(0,o.yg)("inlineCode",{parentName:"td"},"address")," that will receive any excess fee values sent to the endpoint in case the ",(0,o.yg)("inlineCode",{parentName:"td"},"_lzSend")," execution reverts.")))),(0,o.yg)("h3",{id:"implementing-gas-fee-estimation-_quote"},"Implementing gas fee estimation (",(0,o.yg)("inlineCode",{parentName:"h3"},"_quote"),")"),(0,o.yg)("p",null,"As shown in the table provided in the last section, the ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzSend")," function expects an estimated gas ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/LayerZero-Labs/LayerZero-v2/blob/c3213200dfe8fabbf7d92c685590d34e6e70da43/protocol/contracts/interfaces/ILayerZeroEndpointV2.sol#L24"},"fee")," to be provided when sending a message (",(0,o.yg)("inlineCode",{parentName:"p"},"_fee"),")."),(0,o.yg)("p",null,"Therefore, sending a message using the ",(0,o.yg)("inlineCode",{parentName:"p"},"sendMessage")," function of your contract, you first need to estimate the associated gas fees."),(0,o.yg)("p",null,"There are multiple fees incurred when sending a message across chains using LayerZero, including: paying for gas on the source chain, fees paid to DVNs validating the message, and gas on the destination chain. Luckily, LayerZero bundles all of these fees together into a single fee to be paid by the ",(0,o.yg)("inlineCode",{parentName:"p"},"msg.sender"),", and LayerZero Endpoints expose a ",(0,o.yg)("inlineCode",{parentName:"p"},"_quote")," function to estimate this fee."),(0,o.yg)("p",null,"Add a new function to your ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract called ",(0,o.yg)("inlineCode",{parentName:"p"},"estimateFee")," that calls the ",(0,o.yg)("inlineCode",{parentName:"p"},"_quote")," function, as shown below:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},"/// @notice Estimates the gas associated with sending a message.\n/// @param _dstEid The endpoint ID of the destination chain.\n/// @param _message The message to be sent.\n/// @param _options The message execution options (e.g. gas to use on destination).\n/// @return nativeFee Estimated gas fee in native gas.\n/// @return lzTokenFee Estimated gas fee in ZRO token.\nfunction estimateFee(\n   uint32 _dstEid,\n   string memory _message,\n   bytes calldata _options\n) public view returns (uint256 nativeFee, uint256 lzTokenFee) {\n   bytes memory _payload = abi.encode(_message);\n   MessagingFee memory fee = _quote(_dstEid, _payload, _options, false);\n   return (fee.nativeFee, fee.lzTokenFee);\n}\n")),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"estimateFee")," function above calls the inherited ",(0,o.yg)("inlineCode",{parentName:"p"},"_quote")," function, while passing in the following expected data:"),(0,o.yg)("table",null,(0,o.yg)("thead",{parentName:"table"},(0,o.yg)("tr",{parentName:"thead"},(0,o.yg)("th",{parentName:"tr",align:"left"},"Name"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Description"))),(0,o.yg)("tbody",{parentName:"table"},(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_dstEid")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"uint32")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The ",(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/contracts/endpoint-addresses"},"endpoint ID")," of the destination chain the message will be sent to.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_payload")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The message (encoded) that will be sent.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_options")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/contracts/options"},"Additional options")," when sending the message, such as how much gas should be used when receiving the message.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_payInLzToken")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bool")),(0,o.yg)("td",{parentName:"tr",align:"left"},"Boolean flag for which token to use when returning the fee (native or ZRO token).")))),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Your contract\u2019s ",(0,o.yg)("inlineCode",{parentName:"p"},"estimateFee")," function should always be called immediately before calling ",(0,o.yg)("inlineCode",{parentName:"p"},"sendMessage")," to accurately estimate associated gas fees.")),(0,o.yg)("h3",{id:"implementing-message-receiving-_lzreceive"},"Implementing message receiving (",(0,o.yg)("inlineCode",{parentName:"h3"},"_lzReceive"),")"),(0,o.yg)("p",null,"To receive messages on the destination chain, your smart contract must override the ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzReceive")," function inherited from the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/oapp"},"OApp")," contract."),(0,o.yg)("p",null,"Add the following code snippet to your ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract to override the ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzReceive")," function:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},"/// @notice Entry point for receiving messages.\n/// @param _origin The origin information containing the source endpoint and sender address.\n///  - srcEid: The source chain endpoint ID.\n///  - sender: The sender address on the src chain.\n///  - nonce: The nonce of the message.\n/// @param _guid The unique identifier for the received LayerZero message.\n/// @param _message The payload of the received message.\n/// @param _executor The address of the executor for the received message.\n/// @param _extraData Additional arbitrary data provided by the corresponding executor.\nfunction _lzReceive(\n   Origin calldata _origin,\n   bytes32 _guid,\n   bytes calldata payload,\n   address _executor,\n   bytes calldata _extraData\n   ) internal override {\n       data = abi.decode(payload, (string));\n       // other logic\n}\n")),(0,o.yg)("p",null,"The overridden ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzReceive")," function receives the following arguments when receiving a message:"),(0,o.yg)("table",null,(0,o.yg)("thead",{parentName:"table"},(0,o.yg)("tr",{parentName:"thead"},(0,o.yg)("th",{parentName:"tr",align:"left"},"Name"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Description"))),(0,o.yg)("tbody",{parentName:"table"},(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_origin")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"Origin")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The origin information containing the source endpoint and sender address.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_guid")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes32")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The unique identifier for the received LayerZero message.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"payload")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The payload of the received message (encoded).")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_executor")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"address")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The ",(0,o.yg)("inlineCode",{parentName:"td"},"address")," of the ",(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/explore/executors"},"Executor")," for the received message.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_extraData ")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes")),(0,o.yg)("td",{parentName:"tr",align:"left"},"Additional arbitrary data provided by the corresponding ",(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/explore/executors"},"Executor"),".")))),(0,o.yg)("p",null,"Note that the overridden method decodes the message payload, and stores the string into a variable named ",(0,o.yg)("inlineCode",{parentName:"p"},"data")," that you can read from later to fetch the latest message."),(0,o.yg)("p",null,"Add the ",(0,o.yg)("inlineCode",{parentName:"p"},"data")," field as a member variable to your contract:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},"contract ExampleContract is OApp {\n\n    // highlight-next-line\n    string public data;\n\n    constructor(address _endpoint) OApp(_endpoint, msg.sender) {}\n}\n")),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Overriding the ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzReceive")," function allows you to provide any custom logic you wish when receiving messages, including making a call back to the source chain by invoking ",(0,o.yg)("inlineCode",{parentName:"p"},"_lzSend"),". Visit the LayerZero ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/message-design-patterns"},"Message Design Patterns")," for common messaging flows.")),(0,o.yg)("h3",{id:"final-code"},"Final code"),(0,o.yg)("p",null,"Once you complete all of the steps above, your contract should look like this:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\nimport { OApp, Origin, MessagingFee } from "@layerzerolabs/lz-evm-oapp-v2/contracts/oapp/OApp.sol";\n\ncontract ExampleContract is OApp {\n\n string public data;\n\n  constructor(address _endpoint) OApp(_endpoint, msg.sender) {}\n\n  /// @notice Sends a message from the source chain to the destination chain.\n  /// @param _dstEid The endpoint ID of the destination chain.\n  /// @param _message The message to be sent.\n  /// @param _options The message execution options (e.g. gas to use on destination).\n  function sendMessage(uint32 _dstEid, string memory _message, bytes calldata _options) external payable {\n     bytes memory _payload = abi.encode(_message); // Encode the message as bytes\n     _lzSend(\n           _dstEid,\n           _payload,\n           _options,\n           MessagingFee(msg.value, 0), // Fee for the message (nativeFee, lzTokenFee)\n           payable(msg.sender) // The refund address in case the send call reverts\n     );\n  }\n\n  /// @notice Estimates the gas associated with sending a message.\n  /// @param _dstEid The endpoint ID of the destination chain.\n  /// @param _message The message to be sent.\n  /// @param _options The message execution options (e.g. gas to use on destination).\n  /// @return nativeFee Estimated gas fee in native gas.\n  /// @return lzTokenFee Estimated gas fee in ZRO token.\n  function estimateFee(\n     uint32 _dstEid,\n     string memory _message,\n     bytes calldata _options\n  ) public view returns (uint256 nativeFee, uint256 lzTokenFee) {\n     bytes memory _payload = abi.encode(_message);\n     MessagingFee memory fee = _quote(_dstEid, _payload, _options, false);\n     return (fee.nativeFee, fee.lzTokenFee);\n  }\n\n  /// @notice Entry point for receiving messages.\n  /// @param _origin The origin information containing the source endpoint and sender address.\n  ///  - srcEid: The source chain endpoint ID.\n  ///  - sender: The sender address on the src chain.\n  ///  - nonce: The nonce of the message.\n  /// @param _guid The unique identifier for the received LayerZero message.\n  /// @param _message The payload of the received message.\n  /// @param _executor The address of the executor for the received message.\n  /// @param _extraData Additional arbitrary data provided by the corresponding executor.\n  function _lzReceive(\n     Origin calldata _origin,\n     bytes32 _guid,\n     bytes calldata payload,\n     address _executor,\n     bytes calldata _extraData\n     ) internal override {\n        data = abi.decode(payload, (string));\n  }\n}\n')),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"compiling-the-smart-contract"},"Compiling the smart contract"),(0,o.yg)("p",null,"Compile the smart contract to ensure it builds without any errors."),(0,o.yg)("p",null,"To compile your smart contract, run:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"forge build\n")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"deploying-the-smart-contract"},"Deploying the smart contract"),(0,o.yg)("h3",{id:"setting-up-your-wallet-as-the-deployer"},"Setting up your wallet as the deployer"),(0,o.yg)("p",null,"Before you can deploy your smart contract to various chains you will need to set up a wallet to be used as the deployer."),(0,o.yg)("p",null,"To do so, you can use the ",(0,o.yg)("a",{parentName:"p",href:"https://book.getfoundry.sh/reference/cast/cast-wallet-import"},(0,o.yg)("inlineCode",{parentName:"a"},"cast wallet import"))," command to import the private key of the wallet into Foundry's securely encrypted keystore:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cast wallet import deployer --interactive\n")),(0,o.yg)("p",null,"After running the command above, you will be prompted to enter your private key, as well as a password for signing transactions."),(0,o.yg)("admonition",{type:"caution"},(0,o.yg)("p",{parentName:"admonition"},"For instructions on how to get your private key from Coinbase Wallet, visit the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.cloud.coinbase.com/wallet-sdk/docs/developer-settings#show-private-key"},"Coinbase Wallet documentation"),". ",(0,o.yg)("strong",{parentName:"p"},"It is critical that you do NOT commit this to a public repo"),".")),(0,o.yg)("p",null,"To confirm that the wallet was imported as the ",(0,o.yg)("inlineCode",{parentName:"p"},"deployer")," account in your Foundry project, run:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"cast wallet list\n")),(0,o.yg)("h3",{id:"setting-up-environment-variables"},"Setting up environment variables"),(0,o.yg)("p",null,"To setup your environment, create an ",(0,o.yg)("inlineCode",{parentName:"p"},".env")," file in the home directory of your project, and add the RPC URLs and ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/endpoint-addresses"},"LayerZero Endpoint")," information for both Base Goerli and Optimism Goerli testnets:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'BASE_GOERLI_RPC="https://goerli.base.org"\nBASE_GOERLI_LZ_ENDPOINT=0x464570adA09869d8741132183721B4f0769a0287\nBASE_GOERLI_LZ_ENDPOINT_ID=40184\n\nOPTIMISM_GOERLI_RPC="https://goerli.optimism.io"\nOPTIMISM_GOERLI_LZ_ENDPOINT=0x464570adA09869d8741132183721B4f0769a0287\nOPTIMISM_GOERLI_LZ_ENDPOINT_ID=40132\n')),(0,o.yg)("p",null,"Once the ",(0,o.yg)("inlineCode",{parentName:"p"},".env")," file has been created, run the following command to load the environment variables in the current command line session:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre"},"source .env\n")),(0,o.yg)("p",null,"With your contract compiled and environment setup, you are now ready to deploy the smart contract to different networks."),(0,o.yg)("h3",{id:"deploying-the-smart-contract-to-base-goerli"},"Deploying the smart contract to Base Goerli"),(0,o.yg)("p",null,"To deploy a smart contract using Foundry, you can use the ",(0,o.yg)("inlineCode",{parentName:"p"},"forge create")," command. The command requires you to specify the smart contract you want to deploy, an RPC URL of the network you want to deploy to, and the account you want to deploy with."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Your wallet must be funded with ETH on the Base Goerli and Optimism Goerli to cover the gas fees associated with the smart contract deployment. Otherwise, the deployment will fail."),(0,o.yg)("p",{parentName:"admonition"},"To get testnet ETH, see the ",(0,o.yg)("a",{parentName:"p",href:"#prerequisites"},"prerequisites"),".")),(0,o.yg)("p",null,"To deploy the ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," smart contract to the Base Goerli testnet, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"forge create ./src/ExampleContract.sol:ExampleContract --rpc-url $BASE_GOERLI_RPC --constructor-args $BASE_GOERLI_LZ_ENDPOINT --account deployer\n")),(0,o.yg)("p",null,"When prompted, enter the password that you set earlier, when you imported your wallet's private key."),(0,o.yg)("p",null,"After running the command above, the contract will be deployed on the Base Goerli test network. You can view the deployment status and contract by using a ",(0,o.yg)("a",{parentName:"p",href:"/tools/block-explorers"},"block explorer"),"."),(0,o.yg)("h3",{id:"deploying-the-smart-contract-to-optimism-goerli"},"Deploying the smart contract to Optimism Goerli"),(0,o.yg)("p",null,"To deploy the ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," smart contract to the Optimism Goerli testnet, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"forge create ./src/ExampleContract.sol:ExampleContract --rpc-url $OPTIMISM_GOERLI_RPC --constructor-args $OPTIMISM_GOERLI_LZ_ENDPOINT --account deployer\n")),(0,o.yg)("p",null,"When prompted, enter the password that you set earlier, when you imported your wallet's private key."),(0,o.yg)("p",null,"After running the command above, the contract will be deployed on the Optimism Goerli test network. You can view the deployment status and contract by using the ",(0,o.yg)("a",{parentName:"p",href:"https://goerli-optimism.etherscan.io/"},"OP Goerli block explorer"),"."),(0,o.yg)("h2",{id:"opening-the-messaging-channels"},"Opening the messaging channels"),(0,o.yg)("p",null,"Once your contract has been deployed to Base Goerli and Optimism Goerli, you will need to open the messaging channels between the two contracts so that they can send and receive messages from one another. This is done by calling the ",(0,o.yg)("inlineCode",{parentName:"p"},"setPeer")," function on the contract."),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"setPeer")," function expects the following arguments:"),(0,o.yg)("table",null,(0,o.yg)("thead",{parentName:"table"},(0,o.yg)("tr",{parentName:"thead"},(0,o.yg)("th",{parentName:"tr",align:"left"},"Name"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Type"),(0,o.yg)("th",{parentName:"tr",align:"left"},"Description"))),(0,o.yg)("tbody",{parentName:"table"},(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_eid")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"uint32")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The ",(0,o.yg)("a",{parentName:"td",href:"https://docs.layerzero.network/contracts/endpoint-addresses"},"endpoint ID")," of the destination chain.")),(0,o.yg)("tr",{parentName:"tbody"},(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"_peer")),(0,o.yg)("td",{parentName:"tr",align:"left"},(0,o.yg)("inlineCode",{parentName:"td"},"bytes32")),(0,o.yg)("td",{parentName:"tr",align:"left"},"The contract address of the OApp contract on the destination chain.")))),(0,o.yg)("h3",{id:"setting-the-peers"},"Setting the peers"),(0,o.yg)("p",null,"Foundry provides the ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command-line tool that can be used to interact with deployed smart contracts and call their functions."),(0,o.yg)("p",null,"To set the peer of your ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contracts, you can use ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," to call the ",(0,o.yg)("inlineCode",{parentName:"p"},"setPeer")," function while providing the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/endpoint-addresses"},"endpoint ID")," and address (in bytes) of the deployed contract on the respective destination chain."),(0,o.yg)("p",null,"To set the peer of the Base Goerli contract to the Optimism Goerli contract, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'cast send <BASE_GOERLI_CONTRACT_ADDRESS> --rpc-url $BASE_GOERLI_RPC "setPeer(uint32, bytes32)" $OPTIMISM_GOERLI_LZ_ENDPOINT_ID <OPTIMISM_GOERLI_CONTRACT_ADDRESS> --account deployer\n')),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Replace ",(0,o.yg)("inlineCode",{parentName:"p"},"<BASE_GOERLI_CONTRACT_ADDRESS>")," with the contract address of your deployed ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract on Base Goerli, and",(0,o.yg)("inlineCode",{parentName:"p"},"<OPTIMISM_GOERLI_CONTRACT_ADDRESS>")," with the contract address (as bytes) of your deployed ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract on Optimism Goerli before running the provided ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command.")),(0,o.yg)("p",null,"To set the peer of the Optimism Goerli contract to the Base Goerli contract, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'cast send <OPTIMISM_GOERLI_CONTRACT_ADDRESS> --rpc-url $OPTIMISM_GOERLI_RPC "setPeer(uint32, bytes32)" $BASE_GOERLI_LZ_ENDPOINT_ID <BASE_GOERLI_CONTRACT_ADDRESS> --account deployer\n')),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Replace ",(0,o.yg)("inlineCode",{parentName:"p"},"<OPTIMISM_GOERLI_CONTRACT_ADDRESS>")," with the contract address of your deployed ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract on Optimism Goerli, and",(0,o.yg)("inlineCode",{parentName:"p"},"<BASE_GOERLI_CONTRACT_ADDRESS>")," with the contract address (as bytes) of your deployed ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract on Base Goerli before running the provided ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command.")),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"sending-messages"},"Sending messages"),(0,o.yg)("p",null,"Once peers have been set on each contract, they are now able to send and receive messages from one another."),(0,o.yg)("p",null,"Sending a message using the newly created ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract can be done in three steps:"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"Build ",(0,o.yg)("a",{parentName:"li",href:"https://docs.layerzero.network/contracts/options"},"message options")," to specify logic associated with the message transaction"),(0,o.yg)("li",{parentName:"ol"},"Call the ",(0,o.yg)("inlineCode",{parentName:"li"},"estimateFee")," function to estimate the gas fee for sending a message"),(0,o.yg)("li",{parentName:"ol"},"Call the ",(0,o.yg)("inlineCode",{parentName:"li"},"sendMessage")," function to send a message")),(0,o.yg)("h3",{id:"building-message-options"},"Building message options"),(0,o.yg)("p",null,"The ",(0,o.yg)("inlineCode",{parentName:"p"},"estimateFee")," and ",(0,o.yg)("inlineCode",{parentName:"p"},"sendMessage")," custom functions of the ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract both require a ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/options"},"message options")," (",(0,o.yg)("inlineCode",{parentName:"p"},"_options"),") argument to be provided."),(0,o.yg)("p",null,"Message options allow you to specify arbitrary logic as part of the message transaction, such as the gas amount the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/explore/executors"},"Executor")," pays for message delivery, the order of message execution, or dropping an amount of gas to a destination address."),(0,o.yg)("p",null,"LayerZero provides a ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/LayerZero-Labs/LayerZero-v2/blob/ccfd0d38f83ca8103b14ab9ca77f32e0419510ff/oapp/contracts/oapp/libs/OptionsBuilder.sol#L12"},"Solidity")," library and ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/options"},"TypeScript SDK")," for building these message options."),(0,o.yg)("p",null,"As an example, below is a Foundry script that uses OptionsBuilder from the Solidity library to generate message options (as ",(0,o.yg)("inlineCode",{parentName:"p"},"bytes"),") that set the gas amount that the Executor will pay upon message delivery to ",(0,o.yg)("inlineCode",{parentName:"p"},"200000")," wei:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-solidity"},'pragma solidity ^0.8.0;\n\nimport {Script, console2} from "forge-std/Script.sol";\nimport { OptionsBuilder } from "@layerzerolabs/lz-evm-oapp-v2/contracts/oapp/libs/OptionsBuilder.sol";\n\ncontract OptionsScript is Script {\n    using OptionsBuilder for bytes;\n\n    function setUp() public {}\n\n    function run() public {\n        bytes memory options = OptionsBuilder.newOptions().addExecutorLzReceiveOption(200000, 0);\n        console2.logBytes(options);\n    }\n}\n')),(0,o.yg)("p",null,"The output of this script results in:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},"0x00030100110100000000000000000000000000030d40\n")),(0,o.yg)("p",null,"For this tutorial, rather than building and generating your own message options, you can use the bytes output provided above."),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Covering all of the different message options in detail is out of scope for this tutorial. If you are interested in learning more about the different message options and how to build them, visit the ",(0,o.yg)("a",{parentName:"p",href:"https://docs.layerzero.network/contracts/options"},"LayerZero developer documentation"),".")),(0,o.yg)("h3",{id:"estimating-the-gas-fee"},"Estimating the gas fee"),(0,o.yg)("p",null,"Before you can send a message from your contract on Base Goerli, you need to estimate the fee associated with sending the message. You can use the ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command to call the ",(0,o.yg)("inlineCode",{parentName:"p"},"estimateFee()")," function of the ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract."),(0,o.yg)("p",null,"To estimate the gas fee for sending a message from Base Goerli to Optimism Goerli, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'cast send <BASE_GOERLI_CONTRACT_ADDRESS> --rpc-url $BASE_GOERLI_RPC "estimateFee(uint32, string, bytes)" $OPTIMISM_GOERLI_LZ_ENDPOINT_ID "Hello World" 0x00030100110100000000000000000000000000030d40 --account deployer\n')),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Replace ",(0,o.yg)("inlineCode",{parentName:"p"},"<BASE_GOERLI_CONTRACT_ADDRESS>")," with the contract address of your deployed ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract on Base Goerli before running the provided ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command.")),(0,o.yg)("p",null,"The command above calls ",(0,o.yg)("inlineCode",{parentName:"p"},"estimateFee(uint32, string, bytes, bool)"),", while providing the required arguments, including: the endpoint ID of the destination chain, the text to send, and the message options (generated in the last section)."),(0,o.yg)("h3",{id:"sending-the-message"},"Sending the message"),(0,o.yg)("p",null,"Once you have fetched the estimated gas for sending your message, you can now call ",(0,o.yg)("inlineCode",{parentName:"p"},"sendMessage")," and provide the value returned as the ",(0,o.yg)("inlineCode",{parentName:"p"},"msg.value"),"."),(0,o.yg)("p",null,"For example, to send a message from Base Goerli to Optimism Goerli with an estimated gas fee, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'cast send <BASE_GOERLI_CONTRACT_ADDRESS> --rpc-url $BASE_GOERLI_RPC --value <GAS_ESTIMATE_IN_WEI> "sendMessage(uint32, string, bytes)" $OPTIMISM_GOERLI_LZ_ENDPOINT_ID "Hello World" 0x00030100110100000000000000000000000000030d40 --account deployer\n')),(0,o.yg)("admonition",{type:"info"},(0,o.yg)("p",{parentName:"admonition"},"Replace ",(0,o.yg)("inlineCode",{parentName:"p"},"<BASE_GOERLI_CONTRACT_ADDRESS>")," with the contract address of your deployed ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," contract on Base Goerli, and ",(0,o.yg)("inlineCode",{parentName:"p"},"<GAS_ESTIMATE_IN_WEI>")," with the gas estimate (in wei) returned by the call to estimateFee, before running the provided ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command.")),(0,o.yg)("p",null,"You can view the status of your cross-chain transaction on ",(0,o.yg)("a",{parentName:"p",href:"https://layerzeroscan.com/"},"LayerZero Scan"),"."),(0,o.yg)("h3",{id:"receiving-the-message"},"Receiving the message"),(0,o.yg)("p",null,"Once the message has been sent and received on the destination chain, the ","_","Receive function will be called on the ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," and the message payload will be stored in the contract's public ",(0,o.yg)("inlineCode",{parentName:"p"},"data")," variable."),(0,o.yg)("p",null,"You can use the ",(0,o.yg)("inlineCode",{parentName:"p"},"cast")," command to read the latest message received by the ",(0,o.yg)("inlineCode",{parentName:"p"},"ExampleContract")," stored in the ",(0,o.yg)("inlineCode",{parentName:"p"},"data")," variable."),(0,o.yg)("p",null,"To read the latest received message data that was sent to Optimism Goerli from Base Goerli, run the following command:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-bash"},'cast send <OPTIMISM_GOERLI_CONTRACT_ADDRESS> --rpc-url $OPTIMISM_GOERLI_RPC "data" --account deployer\n')),(0,o.yg)("p",null,"The returned data should match the message text payload you sent in your message."),(0,o.yg)("p",null,"You can view the status of your cross-chain transaction on ",(0,o.yg)("a",{parentName:"p",href:"https://layerzeroscan.com/"},"LayerZero Scan"),"."),(0,o.yg)("hr",null),(0,o.yg)("h2",{id:"conclusion"},"Conclusion"),(0,o.yg)("p",null,"Congratulations! You have successfully learned how to perform cross-chain messaging between Base and other chains (i.e. Optimism) using LayerZero V2."),(0,o.yg)("p",null,"To learn more about cross-chain messaging and LayerZero V2, check out the following resources:"),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://docs.base.org/tools/cross-chain"},"Cross-chain")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("a",{parentName:"li",href:"https://docs.layerzero.network"},"LayerZero V2"))),(0,o.yg)("hr",null))}c.isMDXComponent=!0}}]);