"use strict";(self.webpackChunk_app_base_docs=self.webpackChunk_app_base_docs||[]).push([[5704],{30876:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var n=a(2784);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(a),h=r,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||o;return a?n.createElement(m,i(i({ref:t},p),{},{components:a})):n.createElement(m,i({ref:t},p))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},17621:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var n=a(7896),r=(a(2784),a(30876));const o={title:"Accessing real-time asset data using Pyth Price Feeds",slug:"/oracles-pyth-price-feeds",description:"A tutorial that teaches how to use Pyth Price Feeds to access real-time asset data, directly from your smart contracts on the Base testnet.",author:"taycaldwell",keywords:["Oracle Oracles","Pyth","Pyth Network","price feeds","data feeds","smart contract","Base blockchain","Base network","Base testnet","Base test network","app development","dapp development","build a dapp on Base","build on Base"],tags:["oracles"],difficulty:"intermediate",displayed_sidebar:null},i=void 0,l={unversionedId:"docs/oracles-pyth-price-feeds",id:"docs/oracles-pyth-price-feeds",title:"Accessing real-time asset data using Pyth Price Feeds",description:"A tutorial that teaches how to use Pyth Price Feeds to access real-time asset data, directly from your smart contracts on the Base testnet.",source:"@site/tutorials/docs/2_oracles-pyth-price-feeds.md",sourceDirName:"docs",slug:"/oracles-pyth-price-feeds",permalink:"/es/tutorials/oracles-pyth-price-feeds",draft:!1,tags:[{label:"oracles",permalink:"/es/tutorials/tags/oracles"}],version:"current",sidebarPosition:2,frontMatter:{title:"Accessing real-time asset data using Pyth Price Feeds",slug:"/oracles-pyth-price-feeds",description:"A tutorial that teaches how to use Pyth Price Feeds to access real-time asset data, directly from your smart contracts on the Base testnet.",author:"taycaldwell",keywords:["Oracle Oracles","Pyth","Pyth Network","price feeds","data feeds","smart contract","Base blockchain","Base network","Base testnet","Base test network","app development","dapp development","build a dapp on Base","build on Base"],tags:["oracles"],difficulty:"intermediate",displayed_sidebar:null}},s={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Foundry",id:"foundry",level:3},{value:"Coinbase Wallet",id:"coinbase-wallet",level:3},{value:"Wallet funds",id:"wallet-funds",level:3},{value:"What is Pyth Network?",id:"what-is-pyth-network",level:2},{value:"Creating a project",id:"creating-a-project",level:2},{value:"Installing Pyth smart contracts",id:"installing-pyth-smart-contracts",level:2},{value:"Writing and compiling the Smart Contract",id:"writing-and-compiling-the-smart-contract",level:2},{value:"Deploying the smart contract",id:"deploying-the-smart-contract",level:2},{value:"Setting up your wallet as the deployer",id:"setting-up-your-wallet-as-the-deployer",level:3},{value:"Setting up environment variables for Base Sepolia",id:"setting-up-environment-variables-for-base-sepolia",level:3},{value:"Deploying the smart contract to Base Sepolia",id:"deploying-the-smart-contract-to-base-sepolia",level:3},{value:"Interacting with the Smart Contract",id:"interacting-with-the-smart-contract",level:2},{value:"Conclusion",id:"conclusion",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(d,(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"This tutorial will guide you through the process of creating a smart contract on Base that utilizes Pyth Network oracles to consume a price feed."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"objectives"},"Objectives"),(0,r.kt)("p",null,"By the end of this tutorial you should be able to do the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Set up a smart contract project for Base using Foundry"),(0,r.kt)("li",{parentName:"ul"},"Install the Pyth smart contracts"),(0,r.kt)("li",{parentName:"ul"},"Consume a Pyth Network price feed within your smart contract"),(0,r.kt)("li",{parentName:"ul"},"Deploy and test your smart contracts on Base")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"foundry"},"Foundry"),(0,r.kt)("p",null,"This tutorial requires you to have Foundry installed."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"From the command-line (terminal), run: ",(0,r.kt)("inlineCode",{parentName:"li"},"curl -L https://foundry.paradigm.xyz | bash")),(0,r.kt)("li",{parentName:"ul"},"Then run ",(0,r.kt)("inlineCode",{parentName:"li"},"foundryup"),", to install the latest (nightly) build of Foundry")),(0,r.kt)("p",null,"For more information, see the Foundry Book ",(0,r.kt)("a",{parentName:"p",href:"https://book.getfoundry.sh/getting-started/installation"},"installation guide"),"."),(0,r.kt)("h3",{id:"coinbase-wallet"},"Coinbase Wallet"),(0,r.kt)("p",null,"In order to deploy a smart contract, you will first need a wallet. You can create a wallet by downloading the Coinbase Wallet browser extension."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Download ",(0,r.kt)("a",{parentName:"li",href:"https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddgcijnmhnfnkdnaad?hl=en"},"Coinbase Wallet"))),(0,r.kt)("h3",{id:"wallet-funds"},"Wallet funds"),(0,r.kt)("p",null,"Deploying contracts to the blockchain requires a gas fee. Therefore, you will need to fund your wallet with ETH to cover those gas fees."),(0,r.kt)("p",null,"For this tutorial, you will be deploying a contract to the Base Sepolia test network. You can fund your wallet with Base Sepolia ETH using one of the faucets listed on the Base ",(0,r.kt)("a",{parentName:"p",href:"https://docs.base.org/tools/network-faucets"},"Network Faucets")," page."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"what-is-pyth-network"},"What is Pyth Network?"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pyth Network")," focuses on ultra-low latency and real-time data, making it suitable for financial applications that require sub-second updates. Pyth's design emphasizes performance, and it is designed to provide data for a range of traditional and DeFi assets."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"creating-a-project"},"Creating a project"),(0,r.kt)("p",null,"Before you can begin writing smart contracts for Base and consuming Pyth price feeds, you need to set up your development environment by creating a Foundry project."),(0,r.kt)("p",null,"To create a new Foundry project, first create a new directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir myproject\n")),(0,r.kt)("p",null,"Then run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd myproject\nforge init\n")),(0,r.kt)("p",null,"This will create a Foundry project, which has the following basic layout:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},".\n\u251c\u2500\u2500 foundry.toml\n\u251c\u2500\u2500 script\n \u2502   \u2514\u2500\u2500 Counter.s.sol\n\u251c\u2500\u2500 src\n \u2502   \u2514\u2500\u2500 Counter.sol\n\u2514\u2500\u2500 test\n    \u2514\u2500\u2500 Counter.t.sol\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"installing-pyth-smart-contracts"},"Installing Pyth smart contracts"),(0,r.kt)("p",null,"To use Pyth price feeds within your project, you need to install Pyth oracle contracts as a project dependency using ",(0,r.kt)("inlineCode",{parentName:"p"},"forge install"),"."),(0,r.kt)("p",null,"To install Pyth oracle contracts, run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"forge install pyth-network/pyth-sdk-solidity@v2.2.0 --no-git --no-commit\n")),(0,r.kt)("p",null,"Once installed, update your ",(0,r.kt)("inlineCode",{parentName:"p"},"foundry.toml")," file by appending the following line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"remappings = ['@pythnetwork/pyth-sdk-solidity/=lib/pyth-sdk-solidity']\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"writing-and-compiling-the-smart-contract"},"Writing and compiling the Smart Contract"),(0,r.kt)("p",null,"Once your project has been created and dependencies have been installed, you can now start writing a smart contract."),(0,r.kt)("p",null,"The Solidity code below defines a smart contract named ",(0,r.kt)("inlineCode",{parentName:"p"},"ExampleContract"),". The code uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"IPyth")," interface from the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/pyth-network/pyth-crosschain/tree/main/target_chains/ethereum/sdk/solidity"},"Pyth Solidity SDK"),"."),(0,r.kt)("p",null,"An instance of",(0,r.kt)("inlineCode",{parentName:"p"},"IPyth")," is defined within the contract that provides functions for consuming Pyth price feeds. The constructor for the ",(0,r.kt)("inlineCode",{parentName:"p"},"IPyth")," interface expects a contract address to be provided. This address provided in the code example below (",(0,r.kt)("inlineCode",{parentName:"p"},"0xA2aa501b19aff244D90cc15a4Cf739D2725B5729"),") corresponds to the Pyth contract address for the Base Sepolia testnet."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Pyth also supports other EVM networks, such as Base Mainnet. For a list of all network contract addresses, visit the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.pyth.network/documentation/pythnet-price-feeds/evm"},"Pyth documentation"),".")),(0,r.kt)("p",null,"The contract also contains a function named ",(0,r.kt)("inlineCode",{parentName:"p"},"getLatestPrice"),". This function takes a provided ",(0,r.kt)("inlineCode",{parentName:"p"},"priceUpdateData")," that is used to get updated price data, and returns the price given a ",(0,r.kt)("inlineCode",{parentName:"p"},"priceId")," of a price feed. The smart contract provided below uses a ",(0,r.kt)("inlineCode",{parentName:"p"},"priceId")," of ",(0,r.kt)("inlineCode",{parentName:"p"},"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace"),", which corresponds to the price feed for ",(0,r.kt)("inlineCode",{parentName:"p"},"ETH / USD"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Pyth provides a number of price feeds. For a list of available price feeds, visit the ",(0,r.kt)("a",{parentName:"p",href:"https://pyth.network/developers/price-feed-ids#pyth-evm-stable"},"Pyth documentation"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\nimport "@pythnetwork/pyth-sdk-solidity/IPyth.sol";\nimport "@pythnetwork/pyth-sdk-solidity/PythStructs.sol";\n\ncontract ExampleContract {\n  IPyth pyth;\n\n  /**\n  * Network: Base Sepolia (testnet)\n  * Address: 0xA2aa501b19aff244D90cc15a4Cf739D2725B5729\n  */\n  constructor() {\n    pyth = IPyth(0xA2aa501b19aff244D90cc15a4Cf739D2725B5729);\n  }\n\n  function getLatestPrice(\n    bytes[] calldata priceUpdateData\n  ) public payable returns (PythStructs.Price memory) {\n    // Update the prices to the latest available values and pay the required fee for it. The `priceUpdateData` data\n    // should be retrieved from our off-chain Price Service API using the `pyth-evm-js` package.\n    // See section "How Pyth Works on EVM Chains" below for more information.\n    uint fee = pyth.getUpdateFee(priceUpdateData);\n    pyth.updatePriceFeeds{ value: fee }(priceUpdateData);\n\n    bytes32 priceID = 0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace;\n    // Read the current value of priceID, aborting the transaction if the price has not been updated recently.\n    // Every chain has a default recency threshold which can be retrieved by calling the getValidTimePeriod() function on the contract.\n    // Please see IPyth.sol for variants of this function that support configurable recency thresholds and other useful features.\n    return pyth.getPrice(priceID);\n  }\n}\n')),(0,r.kt)("p",null,"In your project, add the code provided above to a new file named ",(0,r.kt)("inlineCode",{parentName:"p"},"src/ExampleContract.sol")," and delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"src/Counter.sol")," contract that was generated with the project (You can also delete the ",(0,r.kt)("inlineCode",{parentName:"p"},"test/Counter.t.sol")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"script/Counter.s.sol")," files)."),(0,r.kt)("p",null,"To compile the new smart contract, run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"forge build\n")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"deploying-the-smart-contract"},"Deploying the smart contract"),(0,r.kt)("h3",{id:"setting-up-your-wallet-as-the-deployer"},"Setting up your wallet as the deployer"),(0,r.kt)("p",null,"Before you can deploy your smart contract to the Base network, you will need to set up a wallet to be used as the deployer."),(0,r.kt)("p",null,"To do so, you can use the ",(0,r.kt)("a",{parentName:"p",href:"https://book.getfoundry.sh/reference/cast/cast-wallet-import"},(0,r.kt)("inlineCode",{parentName:"a"},"cast wallet import"))," command to import the private key of the wallet into Foundry's securely encrypted keystore:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cast wallet import deployer --interactive\n")),(0,r.kt)("p",null,"After running the command above, you will be prompted to enter your private key, as well as a password for signing transactions."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"For instructions on how to get your private key from Coinbase Wallet, visit the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.cloud.coinbase.com/wallet-sdk/docs/developer-settings#show-private-key"},"Coinbase Wallet documentation"),"."),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"It is critical that you do NOT commit this to a public repo"),".")),(0,r.kt)("p",null,"To confirm that the wallet was imported as the ",(0,r.kt)("inlineCode",{parentName:"p"},"deployer")," account in your Foundry project, run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cast wallet list\n")),(0,r.kt)("h3",{id:"setting-up-environment-variables-for-base-sepolia"},"Setting up environment variables for Base Sepolia"),(0,r.kt)("p",null,"To setup your environment for deploying to the Base network, create an ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in the home directory of your project, and add the RPC URL for the Base Sepolia testnet:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'BASE_SEPOLIA_RPC="https://sepolia.base.org"\n')),(0,r.kt)("p",null,"Once the ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file has been created, run the following command to load the environment variables in the current command line session:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source .env\n")),(0,r.kt)("h3",{id:"deploying-the-smart-contract-to-base-sepolia"},"Deploying the smart contract to Base Sepolia"),(0,r.kt)("p",null,"With your contract compiled and environment setup, you are ready to deploy the smart contract to the Base Sepolia Testnet!"),(0,r.kt)("p",null,"For deploying a single smart contract using Foundry, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"forge create")," command. The command requires you to specify the smart contract you want to deploy, an RPC URL of the network you want to deploy to, and the account you want to deploy with."),(0,r.kt)("p",null,"To deploy the ",(0,r.kt)("inlineCode",{parentName:"p"},"ExampleContract")," smart contract to the Base Sepolia test network, run the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"forge create ./src/ExampleContract.sol:ExampleContract --rpc-url $BASE_SEPOLIA_RPC --account deployer\n")),(0,r.kt)("p",null,"When prompted, enter the password that you set earlier, when you imported your wallet's private key."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Your wallet must be funded with ETH on the Base Sepolia Testnet to cover the gas fees associated with the smart contract deployment. Otherwise, the deployment will fail."),(0,r.kt)("p",{parentName:"admonition"},"To get testnet ETH for Base Sepolia, see the ",(0,r.kt)("a",{parentName:"p",href:"#prerequisites"},"prerequisites"),".")),(0,r.kt)("p",null,"After running the command above, the contract will be deployed on the Base Sepolia test network. You can view the deployment status and contract by using a ",(0,r.kt)("a",{parentName:"p",href:"/tools/block-explorers"},"block explorer"),"."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"interacting-with-the-smart-contract"},"Interacting with the Smart Contract"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"getLatestPrice(bytes[])")," function of the deployed contract takes a ",(0,r.kt)("inlineCode",{parentName:"p"},"priceUpdateData")," argument that is used to get the latest price. This data can be fetched using the Hermes web service. Hermes allows users to easily query for recent price updates via a REST API. Make a curl request to fetch the ",(0,r.kt)("inlineCode",{parentName:"p"},"priceUpdateData")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"priceId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"curl https://hermes.pyth.network/api/latest_vaas?ids[]=0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace\n")),(0,r.kt)("p",null,"Once you have the ",(0,r.kt)("inlineCode",{parentName:"p"},"priceUpdateData"),", you can use Foundry\u2019s ",(0,r.kt)("inlineCode",{parentName:"p"},"cast")," command-line tool to interact with the smart contract and call the ",(0,r.kt)("inlineCode",{parentName:"p"},"getLatestPrice(bytes[])")," function to fetch the latest price of ETH."),(0,r.kt)("p",null,"To call the ",(0,r.kt)("inlineCode",{parentName:"p"},"getLatestPrice(bytes[])")," function of the smart contract, run the following command, replacing ",(0,r.kt)("inlineCode",{parentName:"p"},"<DEPLOYED_ADDRESS>")," with the address of your deployed contract, and ",(0,r.kt)("inlineCode",{parentName:"p"},"<PRICE_UPDATE_DATA>")," with the ",(0,r.kt)("inlineCode",{parentName:"p"},"priceUpdateData")," returned by the Hermes endpoint:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'cast call <DEPLOYED_ADDRESS> --rpc-url $BASE_SEPOLIA_RPC "getLatestPrice(bytes[])" <PRICE_UPDATE_DATA>\n')),(0,r.kt)("p",null,"You should receive the latest ",(0,r.kt)("inlineCode",{parentName:"p"},"ETH / USD")," price in hexadecimal form."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Congratulations! You have successfully deployed and interacted with a smart contract that consumes a Pyth Network oracle to access a real-time price feed on Base."),(0,r.kt)("p",null,"To learn more about Oracles and using Pyth Network price feeds within your smart contracts on Base, check out the following resources:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.base.org/tools/oracles"},"Oracles")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.pyth.network/documentation/pythnet-price-feeds/evm"},"Pyth Network Price Feeds"))))}u.isMDXComponent=!0}}]);