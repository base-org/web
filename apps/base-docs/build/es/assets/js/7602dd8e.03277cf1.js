"use strict";(self.webpackChunk_app_base_docs=self.webpackChunk_app_base_docs||[]).push([[42],{30876:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(2784);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),h=o,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||r;return n?a.createElement(m,i(i({ref:t},d),{},{components:n})):a.createElement(m,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},3343:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var a=n(7896),o=(n(2784),n(30876));const r={title:"Thirdweb and Unreal - NFT Items",slug:"/thirdweb-unreal-nft-items",description:"Learn how to use NFTs as in-game items using Thirdweb and Unreal.",author:"briandoyle81",keywords:["Solidity","ERC-721","token","NFT","thirdweb","Unreal","c++","blueprints","onchain games"],tags:["nft","smart contracts"],difficulty:"hard",hide_table_of_contents:!1,displayed_sidebar:null},i=void 0,l={unversionedId:"docs/thirdweb-unreal-nft-items",id:"docs/thirdweb-unreal-nft-items",title:"Thirdweb and Unreal - NFT Items",description:"Learn how to use NFTs as in-game items using Thirdweb and Unreal.",source:"@site/tutorials/docs/1_thirdweb-unreal-nft-items.md",sourceDirName:"docs",slug:"/thirdweb-unreal-nft-items",permalink:"/es/tutorials/thirdweb-unreal-nft-items",draft:!1,tags:[{label:"nft",permalink:"/es/tutorials/tags/nft"},{label:"smart contracts",permalink:"/es/tutorials/tags/smart-contracts"}],version:"current",sidebarPosition:1,frontMatter:{title:"Thirdweb and Unreal - NFT Items",slug:"/thirdweb-unreal-nft-items",description:"Learn how to use NFTs as in-game items using Thirdweb and Unreal.",author:"briandoyle81",keywords:["Solidity","ERC-721","token","NFT","thirdweb","Unreal","c++","blueprints","onchain games"],tags:["nft","smart contracts"],difficulty:"hard",hide_table_of_contents:!1,displayed_sidebar:null}},s={},p=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"ERC-721 Tokens",id:"erc-721-tokens",level:3},{value:"Unreal Engine",id:"unreal-engine",level:3},{value:"Onchain Apps",id:"onchain-apps",level:3},{value:"Reviewing the Contract",id:"reviewing-the-contract",level:2},{value:"Getting Started with Unreal",id:"getting-started-with-unreal",level:2},{value:"Setting up the Engine",id:"setting-up-the-engine",level:3},{value:"Setting up the Client and Server",id:"setting-up-the-client-and-server",level:2},{value:"Client",id:"client",level:3},{value:"Server",id:"server",level:3},{value:"Setting Up the Game",id:"setting-up-the-game",level:2},{value:"Adding the Color Changer",id:"adding-the-color-changer",level:2},{value:"Deploying the Contract",id:"deploying-the-contract",level:3},{value:"Adding the Contract to the Server",id:"adding-the-contract-to-the-server",level:3},{value:"Collecting the NFT from the Game",id:"collecting-the-nft-from-the-game",level:3},{value:"Tinting the Car",id:"tinting-the-car",level:3},{value:"Fetching the NFT Colors",id:"fetching-the-nft-colors",level:3},{value:"Getting the Colors into the Game",id:"getting-the-colors-into-the-game",level:3},{value:"Changing the Color of the Car",id:"changing-the-color-of-the-car",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"Random Color NFT Contract",id:"random-color-nft-contract",level:2}],d={toc:p},c="wrapper";function u(e){let{components:t,...r}=e;return(0,o.kt)(c,(0,a.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://thirdweb.com/"},"thirdweb")," provides a number of contracts and tools for building onchain. Their ",(0,o.kt)("a",{parentName:"p",href:"https://portal.thirdweb.com/solutions/gaming/overview"},"Gaming SDK")," enables seamless onboarding, cross-platform support, and provides many other features. It's compatible with ",(0,o.kt)("a",{parentName:"p",href:"https://www.unrealengine.com/en-US"},"Unreal Engine")," and can be used to enable onchain elements in your games."),(0,o.kt)("p",null,"In this tutorial, you'll learn how to add NFT item usage on top of the demo game you build in their ",(0,o.kt)("a",{parentName:"p",href:"https://portal.thirdweb.com/solutions/gaming/unreal-engine/quickstart"},"Unreal Engine Quickstart"),". Specifically, you'll use an NFT collection of random colors to change the color of the player's race car."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Color changing car nft",src:n(76545).Z,width:"578",height:"326"})),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"objectives"},"Objectives"),(0,o.kt)("p",null,"By the end of this tutorial you should be able to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Pull a user's NFTs into an Unreal Engine Game"),(0,o.kt)("li",{parentName:"ul"},"Apply elements from the NFT to game entities"),(0,o.kt)("li",{parentName:"ul"},"Award NFTs to players for game accomplishments or actions")),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("h3",{id:"erc-721-tokens"},"ERC-721 Tokens"),(0,o.kt)("p",null,"This tutorial assumes that you are able to write, test, and deploy your own ERC-721 tokens using the Solidity programming language. If you need to learn that first, check out our content in ",(0,o.kt)("a",{parentName:"p",href:"https://base.org.camp"},"Base Camp")," or the sections specific to ",(0,o.kt)("a",{parentName:"p",href:"https://docs.base.org/base-camp/docs/erc-721-token/erc-721-standard-video"},"ERC-721 Tokens"),"!"),(0,o.kt)("h3",{id:"unreal-engine"},"Unreal Engine"),(0,o.kt)("p",null,"This tutorial will cover everything you need to know to accomplish the learning objectives, but it won't teach you how to make a game. You'll need to take further steps to learn the ",(0,o.kt)("a",{parentName:"p",href:"https://www.unrealengine.com/en-US"},"Unreal Engine")," on your own. You'll also need to have Visual Studio or Visual Studio Code set up to edit and compile Unreal files."),(0,o.kt)("h3",{id:"onchain-apps"},"Onchain Apps"),(0,o.kt)("p",null,"The tutorial assumes you're comfortable with the basics of deploying an app and connecting it to a smart contract. If you're still learning this part, check out our tutorials in ",(0,o.kt)("a",{parentName:"p",href:"https://base.org.camp"},"Base Camp")," for ","[Building an Onchain App]","."),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"reviewing-the-contract"},"Reviewing the Contract"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"#random-color-nft-contract"},"Below"),", you can find an example of an ERC-721 NFT contract. It's an extension of the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openzeppelin.com/contracts/2.x/api/token/erc721"},"OpenZeppelin ERC-721")," implementation. When a user mints, they're granted an NFT with a random color. The metadata is fully onchain, as is the svg image. The image is a simple 1024","*","1024 ",(0,o.kt)("inlineCode",{parentName:"p"},"rect"),", with a ",(0,o.kt)("inlineCode",{parentName:"p"},"fill")," of the randomly generated color."),(0,o.kt)("p",null,"If the user dislikes the color, they may shuffle it and the NFT will change to a new randomly-selected color."),(0,o.kt)("p",null,"These NFTs are not restricted for trading. The contract includes a utility function, ",(0,o.kt)("inlineCode",{parentName:"p"},"getNftsOwned"),", which will return an array containing the ",(0,o.kt)("inlineCode",{parentName:"p"},"tokenId")," and base64-encoded metadata string for all tokens currently owned by the provided ",(0,o.kt)("inlineCode",{parentName:"p"},"address"),"."),(0,o.kt)("h2",{id:"getting-started-with-unreal"},"Getting Started with Unreal"),(0,o.kt)("p",null,"Continue below for some tips on completing the ",(0,o.kt)("a",{parentName:"p",href:"https://portal.thirdweb.com/solutions/gaming/unreal-engine/quickstart"},"Unreal Engine Quickstart")," tutorial provided by thirdweb. This tutorial will guide you through installing the Unreal Engine and setting up the major components of the thirdweb ",(0,o.kt)("a",{parentName:"p",href:"https://portal.thirdweb.com/solutions/gaming/overview"},"Gaming SDK"),"."),(0,o.kt)("p",null,"It will also guide you through setting up the website and backend that are needed to support the game integration. The client in their example uses Next.js, and the server is built with Node and Express."),(0,o.kt)("h3",{id:"setting-up-the-engine"},"Setting up the Engine"),(0,o.kt)("p",null,"First, you need to set up the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/thirdweb-dev/engine"},"Engine"),". For testing, you can ",(0,o.kt)("a",{parentName:"p",href:"https://portal.thirdweb.com/engine/self-host"},"run it locally")," with a ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," container."),(0,o.kt)("p",null,"If you need to, install or update ",(0,o.kt)("a",{parentName:"p",href:"https://www.docker.com/"},"Docker")," and ",(0,o.kt)("a",{parentName:"p",href:"https://www.postgresql.org/"},"Postgres"),"."),(0,o.kt)("p",null,"Start Postgres:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"docker run -p 5432:5432 -e POSTGRES_PASSWORD=postgres -d postgres\n")),(0,o.kt)("p",null,"Make sure Docker desktop is running."),(0,o.kt)("p",null,"Create a ",(0,o.kt)("a",{parentName:"p",href:"https://thirdweb.com/dashboard/settings/api-keys"},"thirdweb API key"),". Allow ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:3000")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:8000")," when creating your api key. When you deploy, you'll need to update the allowed domains."),(0,o.kt)("p",null,"The command to launch the engine itself is complicated and has many parameters. You'll want to create a file and run it from that. Create ",(0,o.kt)("inlineCode",{parentName:"p"},"thirdweb-engine.sh")," in a convenient location and add:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'docker run \\\n  -e ENCRYPTION_PASSWORD="<encryption_password>" \\\n  -e THIRDWEB_API_SECRET_KEY="<thirdweb_secret_key>" \\\n  -e ADMIN_WALLET_ADDRESS="<admin_wallet_address>" \\\n  -e POSTGRES_CONNECTION_URL="postgresql://postgres:postgres@host.docker.internal:5432/postgres?sslmode=disable" \\\n  -e ENABLE_HTTPS=true \\\n  -p 3005:3005 \\\n  --pull=always \\\n  --cpus="0.5" \\\n  thirdweb/engine:latest\n')),(0,o.kt)("p",null,"Enter your ",(0,o.kt)("inlineCode",{parentName:"p"},"THIRDWEB_API_SECRET_KEY")," and the wallet address you sign into thirdweb with as the ",(0,o.kt)("inlineCode",{parentName:"p"},"ADMIN_WALLET_ADDRESS"),". You can see a full list of ",(0,o.kt)("a",{parentName:"p",href:"https://portal.thirdweb.com/engine/self-host#environment-variables"},"environment variables")," in the docs, but shouldn't need to set any others now."),(0,o.kt)("p",null,"Give your script permission to run with ",(0,o.kt)("inlineCode",{parentName:"p"},"chmod +x ./thirdweb-engine.sh")," then run it with ",(0,o.kt)("inlineCode",{parentName:"p"},"./thirdweb-engine.sh\n"),"."),(0,o.kt)("p",null,"It will take awhile to spin up, and you can ignore the warning about the ",(0,o.kt)("inlineCode",{parentName:"p"},"Chain Indexer Listener not started..."),"."),(0,o.kt)("p",null,"Once the engine is running, navigate to ",(0,o.kt)("inlineCode",{parentName:"p"},"https://localhost:3005/json"),". Click through the warning that the connection is not secure. Doing so allows your browser to connect to your engine instance."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"We do not have an official browser recommendation, but during our testing, Chrome worked and Brave did not with the engine setup and configuration.")),(0,o.kt)("p",null,"Navigate to the ",(0,o.kt)("a",{parentName:"p",href:"https://thirdweb.com/dashboard/engine"},"thirdweb engine dashboard"),", and click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Import")," button. Enter a name and the local address for your engine instance:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Add engine instance",src:n(81030).Z,width:"1024",height:"338"})),(0,o.kt)("p",null,"Next, you must add your wallet to the engine instance. Open up the instance in the dashboard, then click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Import")," button next to ",(0,o.kt)("inlineCode",{parentName:"p"},"Backend Wallets"),". Enter your secret key for the wallet."),(0,o.kt)("admonition",{type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"Remember, the wallet key gives full access to all assets within any wallet. Use separate wallets for development and individual production tasks. Don't hold or fund a production wallet with any assets other than the minimum amount necessary for the task it is accomplishing.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Be sure to fund")," this wallet with Base Sepolia ETH. It will be paying the gas for transactions."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The key to your wallet is stored in ephemeral memory in the engine itself. You'll need to re-add it whenever you restart the engine.")),(0,o.kt)("h2",{id:"setting-up-the-client-and-server"},"Setting up the Client and Server"),(0,o.kt)("p",null,"Clone the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/thirdweb-example/engine-express"},"engine-express")," repo. CD into the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," repos and run ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn")," to install dependencies, then CD back to root and run ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn")," again."),(0,o.kt)("p",null,"In both the ",(0,o.kt)("inlineCode",{parentName:"p"},"client")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"server")," folders, copy or rename the ",(0,o.kt)("inlineCode",{parentName:"p"},".env.example")," files as ",(0,o.kt)("inlineCode",{parentName:"p"},".env"),"."),(0,o.kt)("h3",{id:"client"},"Client"),(0,o.kt)("p",null,"In the client ",(0,o.kt)("inlineCode",{parentName:"p"},".env"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Set ",(0,o.kt)("inlineCode",{parentName:"li"},"NEXT_PUBLIC_THIRDWEB_CLIENT_ID")," to the ",(0,o.kt)("strong",{parentName:"li"},"Client ID")," matching your ",(0,o.kt)("a",{parentName:"li",href:"https://thirdweb.com/dashboard/settings/api-keys"},"thirdweb API key")),(0,o.kt)("li",{parentName:"ul"},"You don't need to change the ",(0,o.kt)("inlineCode",{parentName:"li"},"NEXT_PUBLIC_BACKEND_URL")),(0,o.kt)("li",{parentName:"ul"},"Set the ",(0,o.kt)("inlineCode",{parentName:"li"},"NEXT_PUBLIC_THIRDWEB_AUTH_DOMAIN")," as ",(0,o.kt)("inlineCode",{parentName:"li"},"localhost"))),(0,o.kt)("p",null,"In the server ",(0,o.kt)("inlineCode",{parentName:"p"},".env"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Don't change the ",(0,o.kt)("inlineCode",{parentName:"li"},"THIRDWEB_ENGINE_URL"),". (It ",(0,o.kt)("strong",{parentName:"li"},"is")," supposed to be ",(0,o.kt)("inlineCode",{parentName:"li"},"https"),")"),(0,o.kt)("li",{parentName:"ul"},"Set the ",(0,o.kt)("inlineCode",{parentName:"li"},"THIRDWEB_ENGINE_BACKEND_WALLET")," to the same as you used in the engine setup"),(0,o.kt)("li",{parentName:"ul"},"Set the ",(0,o.kt)("inlineCode",{parentName:"li"},"THIRDWEB_AUTH_DOMAIN")," as ",(0,o.kt)("inlineCode",{parentName:"li"},"localhost")),(0,o.kt)("li",{parentName:"ul"},"Set the ",(0,o.kt)("inlineCode",{parentName:"li"},"THIRDWEB_API_SECRET_KEY")," to the ",(0,o.kt)("strong",{parentName:"li"},"Secret Key")," matching your ",(0,o.kt)("a",{parentName:"li",href:"https://thirdweb.com/dashboard/settings/api-keys"},"thirdweb API key")),(0,o.kt)("li",{parentName:"ul"},"Set the ",(0,o.kt)("inlineCode",{parentName:"li"},"THIRDWEB_AUTH_PRIVATE_KEY")," to the private key matching your backend engine wallet")),(0,o.kt)("p",null,"Open ",(0,o.kt)("inlineCode",{parentName:"p"},"client/components/ThirdwebProvider.tsx"),". Update the ",(0,o.kt)("inlineCode",{parentName:"p"},"activeChain")," to Base Sepolia."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { BaseSepoliaTestnet } from '@thirdweb-dev/chains';\n\n// This is the chainId your dApp will work on.\nconst activeChain = BaseSepoliaTestnet;\n")),(0,o.kt)("h3",{id:"server"},"Server"),(0,o.kt)("p",null,"Open ",(0,o.kt)("inlineCode",{parentName:"p"},"server/src/controllers/engineController.ts"),". Update the ",(0,o.kt)("inlineCode",{parentName:"p"},"const"),"s at the beginning to load from environment variables:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"const ENGINE_URL = process.env.THIRDWEB_ENGINE_URL;\nconst BACKEND_WALLET = process.env.THIRDWEB_ENGINE_BACKEND_WALLET;\nconst ERC20_CONTRACT = process.env.ERC20_CONTRACT;\nconst CHAIN = process.env.CHAIN;\n")),(0,o.kt)("p",null,"You'll need to deploy your own version of the ",(0,o.kt)("a",{parentName:"p",href:"https://thirdweb.com/thirdweb.eth/DropERC20"},"Token Drop")," contract. Click ",(0,o.kt)("inlineCode",{parentName:"p"},"Deploy Now"),", then enter the name, symbol, and image of your choosing."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Select ",(0,o.kt)("inlineCode",{parentName:"strong"},"Base Sepolia Testnet")," as the Network / Chain"),"."),(0,o.kt)("p",null,"You can leave the ",(0,o.kt)("inlineCode",{parentName:"p"},"Recipient Address")," as your connected address, and you don't need to do an advanced configuration."),(0,o.kt)("p",null,"Click ",(0,o.kt)("inlineCode",{parentName:"p"},"Deploy Now"),", and approve the transactions to deploy the contract and add it to your dashboard."),(0,o.kt)("p",null,"Next, click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Claim Conditions")," tab on the left side nav. Then click the ",(0,o.kt)("inlineCode",{parentName:"p"},"+ Add Phase")," button and select ",(0,o.kt)("inlineCode",{parentName:"p"},"Public"),". Review the options, but don't change any of them for this demo. Click ",(0,o.kt)("inlineCode",{parentName:"p"},"Save Phases"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"If later in the tutorial, you get an error when you attempt to claim a token, but not an error every four seconds failing to read the balance, it's because you missed this step.")),(0,o.kt)("p",null,"Copy the address from the dashboard:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Token Airdrop Dashboard",src:n(61315).Z,width:"1024",height:"191"})),(0,o.kt)("p",null,"Return to the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," for your server, and add:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-env"},"ERC20_CONTRACT=0x... # Your Address\nCHAIN=84532 # Base Sepolia\n")),(0,o.kt)("p",null,"Run the client and server with ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn client")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn server"),". Navigate to ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:3000"),", create a user, and link a wallet."),(0,o.kt)("h2",{id:"setting-up-the-game"},"Setting Up the Game"),(0,o.kt)("p",null,"Clone the thirdweb ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/thirdweb-example/unreal_demo"},"Unreal Demo"),", and open it with the Unreal Editor. Do so by clicking the ",(0,o.kt)("inlineCode",{parentName:"p"},"Recent Projects")," tab in the upper left, then ",(0,o.kt)("inlineCode",{parentName:"p"},"Browse"),", in the lower right."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Open Unreal Project",src:n(51890).Z,width:"1189",height:"852"})),(0,o.kt)("p",null,"Open the folder cloned from the repo and select ",(0,o.kt)("inlineCode",{parentName:"p"},"unreal_demo.uproject"),". You may need to convert the project to the current version of Unreal. Click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Open a copy")," button."),(0,o.kt)("p",null,"When the scene loads, double-click ",(0,o.kt)("inlineCode",{parentName:"p"},"Scene_Game")," in the upper-right corner."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Scene Game",src:n(89287).Z,width:"1024",height:"387"})),(0,o.kt)("p",null,"Before you can play, you need to do some config. Scroll down in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Outliner")," until you find ",(0,o.kt)("inlineCode",{parentName:"p"},"ThirdWebManager"),". Click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Open Thirdweb Manager")," button to open the file in your editor."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Open Thirdweb Manager",src:n(2258).Z,width:"1024",height:"387"})),(0,o.kt)("p",null,"Then, click the green play button at the top of the viewport."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Play Button",src:n(33745).Z,width:"1024",height:"341"})),(0,o.kt)("p",null,"Log in using the credentials you created on the website, and play the game for a minute or two. If you get a 404, check that your engine, client, and server are all still running."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The demo does not actually have a database connected for users. You'll need to recreate your user each time you restart the server. For production, you'll need to swap this out with an actual database.")),(0,o.kt)("p",null,"If you get an error 500 ",(0,o.kt)("inlineCode",{parentName:"p"},'"No configured wallet found with address 0xABCD...."'),", it's because you didn't add your wallet in the ",(0,o.kt)("a",{parentName:"p",href:"https://thirdweb.com/dashboard/engine"},"thirdweb engine dashboard"),"."),(0,o.kt)("p",null,"Otherwise, the game should run, and you should receive an ERC20 NFT every time you collect one of the orange orbs on the race track."),(0,o.kt)("h2",{id:"adding-the-color-changer"},"Adding the Color Changer"),(0,o.kt)("p",null,"Your next goal is to make it so that your players can use their Random Color NFTs as skins on the race car. You'll need to deploy the ",(0,o.kt)("a",{parentName:"p",href:"#random-color-nft-contract"},"contract provided below"),", set it up to be accessed via the server and engine, and finally, enable the colors from the NFTs to be used to change the color of the car."),(0,o.kt)("h3",{id:"deploying-the-contract"},"Deploying the Contract"),(0,o.kt)("p",null,"You'll use thirdweb's platform to deploy this contract as well. Open a new folder in your editor and run:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npx thirdweb create contract\n")),(0,o.kt)("p",null,"Then:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Name the project - ",(0,o.kt)("inlineCode",{parentName:"li"},"random-color-nft"),", or ",(0,o.kt)("inlineCode",{parentName:"li"},".")," if you run the script from the folder where you want the project"),(0,o.kt)("li",{parentName:"ul"},"Select your preference of ",(0,o.kt)("inlineCode",{parentName:"li"},"Forge")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"Hardhat")),(0,o.kt)("li",{parentName:"ul"},"Name the NFT contract - ",(0,o.kt)("inlineCode",{parentName:"li"},"RandomColorNFT")),(0,o.kt)("li",{parentName:"ul"},"Select ",(0,o.kt)("inlineCode",{parentName:"li"},"Empty Contract"))),(0,o.kt)("p",null,"Open ",(0,o.kt)("inlineCode",{parentName:"p"},"contracts/Contract.sol")," and replace the contents with the ",(0,o.kt)("a",{parentName:"p",href:"#random-color-nft-contract"},"contract provided below"),"."),(0,o.kt)("p",null,"You'll need to import or install the OpenZeppelin contracts. You may also need to update the config for the development environment you're using to ",(0,o.kt)("inlineCode",{parentName:"p"},"0.8.24"),"."),(0,o.kt)("p",null,"Run ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn build"),"."),(0,o.kt)("p",null,"Select ",(0,o.kt)("inlineCode",{parentName:"p"},"y")," to install the thirdweb package and wait for the script to complete."),(0,o.kt)("p",null,"Run ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn deploy"),"."),(0,o.kt)("p",null,"If you haven't linked your device to your thirdweb account, the browser will open to a page asking you to make the connection. Do so now."),(0,o.kt)("p",null,"After the script runs for a moment, it will open the thirdweb dashboard with the deployment UI open. Select ",(0,o.kt)("inlineCode",{parentName:"p"},"Base Sepolia Testnet")," as your network, then click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Deploy Now")," button. Sign the transaction and wait for the contract to deploy."),(0,o.kt)("h3",{id:"adding-the-contract-to-the-server"},"Adding the Contract to the Server"),(0,o.kt)("p",null,"Copy the address for the contract to the clipboard and return to ",(0,o.kt)("inlineCode",{parentName:"p"},"thirdweb-engine-express"),". Open ",(0,o.kt)("inlineCode",{parentName:"p"},"server/.env")," and add:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-env"},"RANDOM_COLOR_NFT_CONTRACT=<your contract address>\n")),(0,o.kt)("p",null,"Open ",(0,o.kt)("inlineCode",{parentName:"p"},"server/src/controllers/engineController.ts")," and add it there as well:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"const RANDOM_COLOR_NFT_CONTRACT = process.env.RANDOM_COLOR_NFT_CONTRACT;\n")),(0,o.kt)("p",null,"Now, using ",(0,o.kt)("inlineCode",{parentName:"p"},"claimERC20")," as a template, add a function to ",(0,o.kt)("inlineCode",{parentName:"p"},"claimRandomColorNFT"),". It's identical, except the ",(0,o.kt)("inlineCode",{parentName:"p"},"url"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"body"),", and error message are:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"// Other code...\nconst url = `${ENGINE_URL}/contract/${CHAIN}/${RANDOM_COLOR_NFT_CONTRACT}/write`;\n// Other code\nconst body = {\n  functionName: 'mintTo',\n  args: [user.ethAddress],\n};\n// Other code\nres.status(400).json({ message: 'Error claiming RandomColorNFT' });\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"A better practice for production would be to make a more generalized function that can handle multiple requests to your contracts. We're skipping that for now to avoid needing to refactor the existing collectibles in the game.")),(0,o.kt)("p",null,"Next, you need to add a route for this function. Open ",(0,o.kt)("inlineCode",{parentName:"p"},"server/src/routes/engineRoutes.ts"),". Import ",(0,o.kt)("inlineCode",{parentName:"p"},"claimRandomColorNFT")," and add a route for it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"router.post('/claim-random-color-nft', claimRandomColorNFT);\n")),(0,o.kt)("h3",{id:"collecting-the-nft-from-the-game"},"Collecting the NFT from the Game"),(0,o.kt)("p",null,"Return to the Unreal Editor and open ",(0,o.kt)("inlineCode",{parentName:"p"},"ThirdwebManager.cpp"),":"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Open ThirdwebManager.cpp",src:n(2258).Z,width:"1024",height:"387"}),"."),(0,o.kt)("p",null,"Similarly to what you did in the server, use the existing ",(0,o.kt)("inlineCode",{parentName:"p"},"PerformClaim()")," as a template to add a function for ",(0,o.kt)("inlineCode",{parentName:"p"},"PerformNFTClaim()"),". The only thing different is the name of the function and the URL:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c++"},'HttpRequest->SetURL(this->ServerUrl + "/engine/claim-random-color-nft");\n')),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Again, it would be better practice to generalize this function, but you can skip that for now to avoid needing to update all the collectibles.")),(0,o.kt)("p",null,"Next, you need to let the editor know about this new function. Open ",(0,o.kt)("inlineCode",{parentName:"p"},"Source/unreal_demo/Public/ThirdwebManager.h"),". Add your new function under the one for ",(0,o.kt)("inlineCode",{parentName:"p"},"PerformClaim();")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c++"},'// Function to perform the NFT claim operation\nUFUNCTION(BlueprintCallable, Category = "Thirdweb")\nvoid PerformNFTClaim();\n')),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Build your project")),(0,o.kt)("p",null,"Once it's done compiling, return UnrealEditor. In the ",(0,o.kt)("inlineCode",{parentName:"p"},"Outliner"),", open the folder for ",(0,o.kt)("inlineCode",{parentName:"p"},"Collectibles")," and click ",(0,o.kt)("inlineCode",{parentName:"p"},"Edit Collectible"),". In the new window, click ",(0,o.kt)("inlineCode",{parentName:"p"},"File->Save As...")," and save a copy as ",(0,o.kt)("inlineCode",{parentName:"p"},"CollectibleNFT"),"."),(0,o.kt)("p",null,"Open the ",(0,o.kt)("inlineCode",{parentName:"p"},"Content Drawer")," at the bottom, search for ",(0,o.kt)("inlineCode",{parentName:"p"},"CollectibleNFT"),", and drag one into the scene. Find it in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Outliner")," and click ",(0,o.kt)("inlineCode",{parentName:"p"},"Edit Collectible NFT"),"."),(0,o.kt)("p",null,"Find the ",(0,o.kt)("inlineCode",{parentName:"p"},"Perform Claim")," function call and replace it with ",(0,o.kt)("inlineCode",{parentName:"p"},"Perform NFT Claim"),". ",(0,o.kt)("strong",{parentName:"p"},"Note")," that the ",(0,o.kt)("inlineCode",{parentName:"p"},"Target")," is passed from ",(0,o.kt)("inlineCode",{parentName:"p"},"Get Actor of Class"),"."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Perform NFT Claim",src:n(10187).Z,width:"1024",height:"344"})),(0,o.kt)("p",null,"You'll want to be able to tell this collectible apart, so click on the mesh for ",(0,o.kt)("inlineCode",{parentName:"p"},"Collectible")," on the left side in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Component")," tree, then on the ",(0,o.kt)("inlineCode",{parentName:"p"},"Details")," panel on the right, find the ",(0,o.kt)("inlineCode",{parentName:"p"},"Materials")," section and change it to ",(0,o.kt)("inlineCode",{parentName:"p"},"MI_Solid_Blue"),"."),(0,o.kt)("p",null,"Click the icons at the top to ",(0,o.kt)("inlineCode",{parentName:"p"},"Compile")," and save your asset."),(0,o.kt)("p",null,"From the content drawer, drag your asset into the viewport."),(0,o.kt)("p",null,"You should now see a blue orb floating where you placed it."),(0,o.kt)("p",null,"Make sure the orb is low enough to drive through, then run the game. Collect the orb, then verify on a block explorer that you received the NFT."),(0,o.kt)("h3",{id:"tinting-the-car"},"Tinting the Car"),(0,o.kt)("p",null,"In the content browser, open ",(0,o.kt)("inlineCode",{parentName:"p"},"All>Content>Vehicles>SportsCar>Materials"),". Right-click in an empty spot and select ",(0,o.kt)("inlineCode",{parentName:"p"},"Material>Material Parameter Collection"),". Name yours ",(0,o.kt)("inlineCode",{parentName:"p"},"NFT_MPS"),". Open the collection, click the ",(0,o.kt)("inlineCode",{parentName:"p"},"+")," to add an item to ",(0,o.kt)("inlineCode",{parentName:"p"},"Vector Parameters")," and create the color of your choosing. Bright red is a good option to make your change very visible."),(0,o.kt)("p",null,"Right-click in an empty spot again and select ",(0,o.kt)("inlineCode",{parentName:"p"},"Create Basic Asset>Material"),". Name your new material ",(0,o.kt)("inlineCode",{parentName:"p"},"M_NFT_Color"),". Open it by double-clicking."),(0,o.kt)("p",null,"Right-click on the graph and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Collection Parameter")," node. In the ",(0,o.kt)("inlineCode",{parentName:"p"},"Details")," panel on the left, select your ",(0,o.kt)("inlineCode",{parentName:"p"},"NFT_MPS")," collection and pick the first vector for ",(0,o.kt)("inlineCode",{parentName:"p"},"Parameter Name")),(0,o.kt)("p",null,"Connect the output to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Base Color")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"M_NFT_Color"),", then save and close the editor."),(0,o.kt)("p",null,"Again in the content browser, right-click on the ",(0,o.kt)("inlineCode",{parentName:"p"},"M_NFT_Color")," asset and select ",(0,o.kt)("inlineCode",{parentName:"p"},"Create Material Instance"),". Name the instance ",(0,o.kt)("inlineCode",{parentName:"p"},"MI_NFT_Color"),"."),(0,o.kt)("p",null,"Navigate to the sports car mesh located in ",(0,o.kt)("inlineCode",{parentName:"p"},"VehicleTemplate>Blueprints>SportsCar")," and double-click to to open the ",(0,o.kt)("inlineCode",{parentName:"p"},"SportsCar_pawn"),". Select the ",(0,o.kt)("inlineCode",{parentName:"p"},"Mesh")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Components")," tree and you should see the car in the editor."),(0,o.kt)("p",null,"On the right side, change the ",(0,o.kt)("inlineCode",{parentName:"p"},"Element 2")," material to ",(0,o.kt)("inlineCode",{parentName:"p"},"MI_NFT_Color"),". The car is now bright red. Radical! Take your newly red car for a spin."),(0,o.kt)("h3",{id:"fetching-the-nft-colors"},"Fetching the NFT Colors"),(0,o.kt)("p",null,"Return to ",(0,o.kt)("inlineCode",{parentName:"p"},"engine-express")," and open ",(0,o.kt)("inlineCode",{parentName:"p"},"engineController.ts"),". Add a function to ",(0,o.kt)("inlineCode",{parentName:"p"},"getNFTColors")," that uses the ",(0,o.kt)("inlineCode",{parentName:"p"},"read")," endpoint to call the ",(0,o.kt)("inlineCode",{parentName:"p"},"getNFTsOwned")," function."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"export const getNFTColors = async (req: Request, res: Response) => {\n  const { authToken } = req.body;\n  if (!authToken || !userTokens[authToken]) {\n    return res.status(400).json({ message: 'Invalid auth token' });\n  }\n  const user = userTokens[authToken];\n  try {\n    const url = `${ENGINE_URL}/contract/${CHAIN}/${RANDOM_COLOR_NFT_CONTRACT}/read?functionName=getNftsOwned&args=${user.ethAddress}`;\n    const headers = {\n      'x-backend-wallet-address': BACKEND_WALLET,\n      Authorization: `Bearer ${process.env.THIRDWEB_API_SECRET_KEY}`,\n    };\n\n    const response = await axiosInstance.get(url, { headers: headers });\n\n    // TODO:  Extract the color from the image\n\n    // TODO: Replace response\n    res.json(response.data);\n  } catch (error) {\n    console.error(error);\n    res.status(400).json({ message: 'Error getting NFT data' });\n  }\n};\n")),(0,o.kt)("p",null,"You'll also need to add this function to ",(0,o.kt)("inlineCode",{parentName:"p"},"engineRoutes.ts"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"router.post('/get-nft-colors', getNFTColors);\n")),(0,o.kt)("p",null,"Return to ",(0,o.kt)("inlineCode",{parentName:"p"},"engineController.ts"),"."),(0,o.kt)("p",null,"Because Unreal doesn't support SVGs, you'll need to extract the color from your NFT metadata, and pass that to use in the material you created. Start by adding a type for the response, and for the JSON metadata:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"type NFTData = {\n  tokenId: bigint;\n  metadata: string;\n};\n\ntype JSONMetadata = {\n  name: string;\n  description: string;\n  image: string;\n};\n")),(0,o.kt)("p",null,"You'll also need helper functions to decode the base64 encoded metadata and SVG, then get the color from the SVG."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"function getJsonMetadata(nft: NFTData) {\n  const base64String = nft.metadata.split(',')[1];\n  const jsonString = atob(base64String);\n  return JSON.parse(jsonString) as JSONMetadata;\n}\n\nfunction getColorFromBase64StringSVG(base64String: string) {\n  const base64Data = base64String.split(',')[1];\n  const svgString = atob(base64Data);\n  const color = svgString.match(/fill=['\"](#[0-9a-fA-F]{6})['\"]/);\n  return color ? color[1] : '#000000';\n}\n")),(0,o.kt)("p",null,"Use these to extract an array of colors and return it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"const nfts = response.data.result.map((item: any) => {\n  return {\n    tokenId: item[0],\n    metadata: item[1],\n  };\n});\n\nconst metadata = nfts.map((nft: NFTData) => getJsonMetadata(nft));\nconst colors = metadata.map((m: JSONMetadata) => getColorFromBase64StringSVG(m.image));\n\nres.json(colors);\n// Delete res.json(response.data);\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"To test with Postman or similar, comment out the check for a valid ",(0,o.kt)("inlineCode",{parentName:"p"},"authToken")," and hardcode in an address that you know has NFTs.")),(0,o.kt)("h3",{id:"getting-the-colors-into-the-game"},"Getting the Colors into the Game"),(0,o.kt)("p",null,"Return to the game in your code editor, and open ",(0,o.kt)("inlineCode",{parentName:"p"},"ThirdwebManager.cpp")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"ThirdwebManager.h"),". As before, add a function to call and endpoint on your server. This time to retrieve the array of colors. You'll need to do a little more for this one to set an in-game variable for the colors."),(0,o.kt)("p",null,"First, you'll need to add a new multicast delegate type to handle the response in ",(0,o.kt)("inlineCode",{parentName:"p"},"ThirdwebManager.h"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c++"},"// ThirdwebManager.h\nDECLARE_DYNAMIC_MULTICAST_DELEGATE_TwoParams(FOnNFTColorsResponse, bool, bWasSuccessful, const TArray<FString> &, ResponseArray);\n")),(0,o.kt)("p",null,"And expose it to the editor:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c++"},'// ThirdwebManager.h\n// This delegate is triggered in C++, and Blueprints can bind to it.\nUPROPERTY(BlueprintAssignable, Category = "Thirdweb", meta = (DisplayName = "OnNFTColorsResponse"))\nFOnNFTColorsResponse OnNFTColorsResponse;;\n')),(0,o.kt)("p",null,"Then, add the function to ",(0,o.kt)("inlineCode",{parentName:"p"},"ThirdwebManager.cpp"),". It's similar, but instead hits the endpoint for the NFT color array and uses the response you just created. It also expects the response to be an array of strings instead of searching for a property called ",(0,o.kt)("inlineCode",{parentName:"p"},"result"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c++"},'// ThirdwebManager.cpp\nvoid AThirdwebManager::GetNFTColors()\n{\n    TSharedRef<IHttpRequest, ESPMode::ThreadSafe> HttpRequest = FHttpModule::Get().CreateRequest();\n    HttpRequest->SetURL(this->ServerUrl + "/engine/get-nft-colors"); // The endpoint to get the NFT colors\n    HttpRequest->SetVerb("POST");\n    HttpRequest->SetHeader(TEXT("Content-Type"), TEXT("application/json"));\n\n    TSharedPtr<FJsonObject> JsonObject = MakeShareable(new FJsonObject);\n    JsonObject->SetStringField("authToken", AuthToken);\n\n    FString OutputString;\n    TSharedRef<TJsonWriter<>> Writer = TJsonWriterFactory<>::Create(&OutputString);\n    FJsonSerializer::Serialize(JsonObject.ToSharedRef(), Writer);\n\n    UE_LOG(LogTemp, Warning, TEXT("OutputString: %s"), *OutputString);\n\n    HttpRequest->SetContentAsString(OutputString);\n\n    HttpRequest->OnProcessRequestComplete().BindLambda([this](FHttpRequestPtr Request, FHttpResponsePtr Response, bool bWasSuccessful)\n        {\n        if (bWasSuccessful && Response.IsValid())\n        {\n            int32 StatusCode = Response->GetResponseCode();\n            if (StatusCode == 200)\n            {\n                TArray<TSharedPtr<FJsonValue>> JsonArray;\n                TSharedRef<TJsonReader<>> Reader = TJsonReaderFactory<>::Create(Response->GetContentAsString());\n                if (FJsonSerializer::Deserialize(Reader, JsonArray) && JsonArray.Num() > 0)\n                {\n                    TArray<FString> ResponseArray;\n                    for (const TSharedPtr<FJsonValue>& Value : JsonArray)\n                    {\n                        FString StringValue;\n                        if (Value->TryGetString(StringValue))\n                        {\n                            ResponseArray.Add(StringValue);\n                        }\n                    }\n                    this->OnNFTColorsResponse.Broadcast(true, ResponseArray);\n                    UE_LOG(LogTemp, Warning, TEXT("Get NFT Color response: %s"), *Response->GetContentAsString());\n                    return;\n                }\n                this->OnNFTColorsResponse.Broadcast(false, TArray<FString>());\n            }\n            else\n            {\n                FString ErrorMsg = FString::Printf(TEXT("HTTP Error: %d, Response: %s"), StatusCode, *(Response->GetContentAsString()));\n                TArray<FString> ErrorArray;\n                ErrorArray.Add(ErrorMsg);\n                this->OnNFTColorsResponse.Broadcast(false, ErrorArray);\n                UE_LOG(LogTemp, Warning, TEXT("ErrorMsg: %s"), *ErrorMsg);\n            }\n        }\n        else\n        {\n            TArray<FString> ErrorArray;\n            ErrorArray.Add(TEXT("Failed to connect to the server."));\n            this->OnNFTColorsResponse.Broadcast(false, ErrorArray);\n            UE_LOG(LogTemp, Warning, TEXT("Failed to connect to the server."));\n        } });\n\n    HttpRequest->ProcessRequest();\n}\n')),(0,o.kt)("p",null,"Finally, expose this function to the editor."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c++"},'// ThirdwebManager.h\n// Function to perform the get NFT Colors operation\nUFUNCTION(BlueprintCallable, Category = "Thirdweb")\nvoid GetNFTColors();\n')),(0,o.kt)("p",null,"Compile and reload the project in the editor."),(0,o.kt)("p",null,"In the content browser, find and open ",(0,o.kt)("inlineCode",{parentName:"p"},"Content>_Thirdweb>Blueprints>Canvas_HUD"),"."),(0,o.kt)("p",null,"Under the text field for ",(0,o.kt)("inlineCode",{parentName:"p"},"Tokens"),", drag a new ",(0,o.kt)("inlineCode",{parentName:"p"},"Text")," widget in. Set the name at the top to ",(0,o.kt)("inlineCode",{parentName:"p"},"Label_Colors")," and check ",(0,o.kt)("inlineCode",{parentName:"p"},"Is Variable"),". Change the ",(0,o.kt)("inlineCode",{parentName:"p"},"Content")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"Colors"),". If you put it on the right side, move the ",(0,o.kt)("inlineCode",{parentName:"p"},"Anchor")," to the upper right corner."),(0,o.kt)("p",null,"In the upper right, click the ",(0,o.kt)("inlineCode",{parentName:"p"},"Graph")," tab. Add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Sequence")," node to split the flow after ",(0,o.kt)("inlineCode",{parentName:"p"},"Get Actor Of Class"),". Following the same pattern as the flow that gets the balance response, add one that gets the NFT colors."),(0,o.kt)("p",null,"Create the ",(0,o.kt)("inlineCode",{parentName:"p"},"Bind Event to OnNFTColorsResponse")," node first, then create the ",(0,o.kt)("inlineCode",{parentName:"p"},"Custom Event")," node from dragging from ",(0,o.kt)("inlineCode",{parentName:"p"},"Event"),"."),(0,o.kt)("p",null,"For now, simply grab the last color in the array and set it in the HUD. To get it, drag off the ",(0,o.kt)("inlineCode",{parentName:"p"},"Response Array")," in ",(0,o.kt)("inlineCode",{parentName:"p"},"OnNFTColorResponseReceived")," and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Last Index")," node. Drag again from the ",(0,o.kt)("inlineCode",{parentName:"p"},"Response Array")," and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Get (Ref)")," node. Connect the output of ",(0,o.kt)("inlineCode",{parentName:"p"},"Last Index")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Input")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"Get"),". From there, drag from the output of ",(0,o.kt)("inlineCode",{parentName:"p"},"Get")," and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"To Text (String)")," node."),(0,o.kt)("p",null,"Drag out of the exec (white) connector of ",(0,o.kt)("inlineCode",{parentName:"p"},"OnNFTColorResponseReceived")," and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Branch")," and connect ",(0,o.kt)("inlineCode",{parentName:"p"},"Was Successful")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Condition"),". For the ",(0,o.kt)("inlineCode",{parentName:"p"},"True")," state, drag and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"SetText (Text)"),". Right click and add a reference to ",(0,o.kt)("inlineCode",{parentName:"p"},"Label Colors")," and drag it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Target")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"SetText"),". Connect the ",(0,o.kt)("inlineCode",{parentName:"p"},"Return Value")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"To Text (String)")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"In Text"),"."),(0,o.kt)("p",null,"Finally, drag off ",(0,o.kt)("inlineCode",{parentName:"p"},"Bind Event to OnNFTColorsResponse")," and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Set Timer by Function Name")," node. Connect the ",(0,o.kt)("inlineCode",{parentName:"p"},"Return Value")," of ",(0,o.kt)("inlineCode",{parentName:"p"},"Get Actor Of Class")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"Object"),". Set the ",(0,o.kt)("inlineCode",{parentName:"p"},"Function Name")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"GetNFTColors")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"Time")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"2.0"),"."),(0,o.kt)("p",null,"You should end up with something like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Get NFT Colors",src:n(44288).Z,width:"1024",height:"348"})),(0,o.kt)("p",null,"Compile the blueprint then run the game. You should see that last color in the array in the HUD, and you should see the full list printed in the console every two seconds."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"If you have an error in your ",(0,o.kt)("inlineCode",{parentName:"p"},"GetNFTColors")," function that prevents ",(0,o.kt)("inlineCode",{parentName:"p"},".Broadcast")," from being called, nothing in the NFT Colors branch of this blueprint will run, including printing to the console.")),(0,o.kt)("h3",{id:"changing-the-color-of-the-car"},"Changing the Color of the Car"),(0,o.kt)("p",null,"Now that you have the colors, you can use them to change the color of your car! For now, you can just set the car to the last color, but on your own you'll want to add a UI widget to allow the player to pick their color."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"If you really wanted to get fancy, you could modify the contract to emit an ",(0,o.kt)("inlineCode",{parentName:"p"},"event")," containing the color of the newly-minted NFT, extract that from the receipt, and optimistically make it available to the player a few seconds earlier.")),(0,o.kt)("p",null,"Unreal doesn't use hex colors, so you'll need to convert your hex string to a linear color and save it in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Material Parameter Collection")," you created earlier."),(0,o.kt)("p",null,"Converting the hex code with a blueprint is very complicated. Luckily, Unreal has a helpful community that has created many utilities, including a ",(0,o.kt)("a",{parentName:"p",href:"https://blueprintue.com/blueprint/vm4ujcqe/"},"conversion function"),"."),(0,o.kt)("admonition",{type:"danger"},(0,o.kt)("p",{parentName:"admonition"},"Copying and pasting code for a game engine isn't quite as dangerous as copying and pasting unknown smart contract code, but you're working at the intersection of these worlds. Be sure to review and make sure you understand anything you find online.")),(0,o.kt)("p",null,"In the content browser, add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Blueprints>Blueprint Function Library")," called ",(0,o.kt)("inlineCode",{parentName:"p"},"ColorUtils"),". In it, add a function called ",(0,o.kt)("inlineCode",{parentName:"p"},"HexStringToColor"),"."),(0,o.kt)("p",null,"Copy the code from the community site and paste it into the function. Connect the ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String to Color")," node to the ",(0,o.kt)("inlineCode",{parentName:"p"},"SET")," node attached to ",(0,o.kt)("inlineCode",{parentName:"p"},"Make Array"),", then from ",(0,o.kt)("inlineCode",{parentName:"p"},"SET")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Return Node"),"."),(0,o.kt)("p",null,"Compile, and you'll get an error. Find and right-click on the error in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex Code")," node, then select ",(0,o.kt)("inlineCode",{parentName:"p"},"Create local variable"),". Recompile and the error will resolve."),(0,o.kt)("p",null,"You also need to input the string you want converted. Select the ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String to Color")," node and click the ",(0,o.kt)("inlineCode",{parentName:"p"},"+")," button by ",(0,o.kt)("inlineCode",{parentName:"p"},"Inputs")," located in the panel on the right. Name it ",(0,o.kt)("inlineCode",{parentName:"p"},"hexString")," and give it a ",(0,o.kt)("inlineCode",{parentName:"p"},"string")," type. ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String")," will now appear as a value in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String to Color")," node. Connect it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Source String")," input in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Replace")," node."),(0,o.kt)("p",null,"Compile one last time, then save and close ",(0,o.kt)("inlineCode",{parentName:"p"},"ColorUtils"),"."),(0,o.kt)("p",null,"Return to ",(0,o.kt)("inlineCode",{parentName:"p"},"Canvas_HUD")," and open the ",(0,o.kt)("inlineCode",{parentName:"p"},"Graph"),". Drag out of the ",(0,o.kt)("inlineCode",{parentName:"p"},"SetText")," node that adds the color to the HUD and add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String to Color")," node. The function expects alpha values in the hex code. To add this connect a second output of the string array ",(0,o.kt)("inlineCode",{parentName:"p"},"GET")," to an ",(0,o.kt)("inlineCode",{parentName:"p"},"Append")," function and append ",(0,o.kt)("inlineCode",{parentName:"p"},"ff")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"B")," input. Connect the ",(0,o.kt)("inlineCode",{parentName:"p"},"Return Value")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String")," input in ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String to Color"),"."),(0,o.kt)("p",null,"Finally, add a ",(0,o.kt)("inlineCode",{parentName:"p"},"Set Vector Parameter Value"),". Select ",(0,o.kt)("inlineCode",{parentName:"p"},"NFT_MPS")," for the collection and ",(0,o.kt)("inlineCode",{parentName:"p"},"Vector")," for the ",(0,o.kt)("inlineCode",{parentName:"p"},"Parameter Name"),". Connect the ",(0,o.kt)("inlineCode",{parentName:"p"},"Liner Color")," output of ",(0,o.kt)("inlineCode",{parentName:"p"},"Hex String to Color")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"Parameter Value")," input."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Hex to linear color",src:n(46517).Z,width:"1024",height:"548"})),(0,o.kt)("p",null,"Compile, save, and close ",(0,o.kt)("inlineCode",{parentName:"p"},"Canvas_HUD"),". Run the game. Your car will start red, but after the response from the server, it will turn the color of your last NFT! Drive and collect the NFT collectible, and it will change colors!"),(0,o.kt)("h2",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"In this tutorial, you've learned how to set up Thirdweb's engine and use it to connect an Unreal Engine game to Base. You've also learned how to use their platform to deploy and manager your contracts. Finally, you've learned how to build game elements to allow players to collect new NFTs and use them to personalize their game items."),(0,o.kt)("h2",{id:"random-color-nft-contract"},"Random Color NFT Contract"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: UNLICENSED\npragma solidity ^0.8.24;\n\nimport "hardhat/console.sol";\nimport "@openzeppelin/contracts/token/ERC721/ERC721.sol";\nimport "@openzeppelin/contracts/utils/Base64.sol";\nimport "@openzeppelin/contracts/utils/Strings.sol";\nimport "@openzeppelin/contracts/utils/structs/EnumerableSet.sol";\n\ncontract RandomColorNFT is ERC721 {\n  using EnumerableSet for EnumerableSet.UintSet;\n\n  mapping (address => EnumerableSet.UintSet) tokensOwned;\n\n  uint public counter;\n\n  mapping (uint => string) public tokenIdToColor;\n\n  error InvalidTokenId(uint tokenId);\n  error OnlyOwner(address);\n\n  constructor() ERC721("RandomColorNFT", "RCNFT") {\n  }\n\n  function mintTo(address _to) public {\n    counter++;\n    _safeMint(_to, counter);\n    tokenIdToColor[counter] = generateRandomColor();\n  }\n\n  struct TokenAndMetatdata {\n    uint tokenId;\n    string metadata;\n  }\n\n  function getNftsOwned(address owner) public view returns (TokenAndMetatdata[] memory) {\n    TokenAndMetatdata[] memory tokens = new TokenAndMetatdata[](tokensOwned[owner].length());\n    for (uint i = 0; i < tokensOwned[owner].length(); i++) {\n      uint tokenId = tokensOwned[owner].at(i);\n      tokens[i] = TokenAndMetatdata(tokenId, tokenURI(tokenId));\n    }\n    return tokens;\n  }\n\n  function shuffleColor(uint _tokenId) public {\n    if(_tokenId > counter) {\n      revert InvalidTokenId(_tokenId);\n    }\n    if(ownerOf(_tokenId) != msg.sender) {\n      revert OnlyOwner(msg.sender);\n    }\n    tokenIdToColor[_tokenId] = generateRandomColor();\n  }\n\n  function _update(address to, uint256 tokenId, address auth) internal override(ERC721) returns(address) {\n    // Only remove the token if it is not being minted\n    if (tokenId != counter){\n      tokensOwned[auth].remove(tokenId);\n    }\n    tokensOwned[to].add(tokenId);\n\n    return super._update(to, tokenId, auth);\n  }\n\n  function _baseURI() internal pure override returns (string memory) {\n    return "data:application/json;base64,";\n  }\n\n  function tokenURI(uint _tokenId) public view override returns (string memory) {\n    if(_tokenId > counter) {\n      revert InvalidTokenId(_tokenId);\n    }\n\n    string memory json = Base64.encode(\n      bytes(\n        string(\n          abi.encodePacked(\n          \'{"name": "\',\n          name(),\n          \' #: \',\n          Strings.toString(_tokenId),\n          \'","description": "Random colors are pretty or boring!", "image": "data:image/svg+xml;base64,\',\n          Base64.encode(bytes(render(_tokenId))),\n          \'"}\'\n          )\n        )\n      )\n    );\n\n    return string(abi.encodePacked(_baseURI(), json));\n  }\n\n  function render(uint _tokenId) public view returns (string memory) {\n    return string(\n      abi.encodePacked(\n        "<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 1024 1024\'>",\n        "<rect width=\'1024\' height=\'1024\' fill=\'",\n        tokenIdToColor[_tokenId],\n        "\' />",\n        "</svg>"\n      )\n    );\n  }\n\n  // Function to generate a random color hex code\n  function generateRandomColor() public view returns (string memory) {\n    // Generate a pseudo-random number using block.prevrandao\n    uint256 randomNum = uint256(keccak256(abi.encodePacked(block.prevrandao, block.timestamp, msg.sender)));\n\n    // Extract RGB components from the random number\n    bytes memory colorBytes = new bytes(3);\n    colorBytes[0] = bytes1(uint8(randomNum >> 16));\n    colorBytes[1] = bytes1(uint8(randomNum >> 8));\n    colorBytes[2] = bytes1(uint8(randomNum));\n\n    // Convert RGB components to hex string\n    string memory colorHex = string(abi.encodePacked(\n      "#",\n      toHexDigit(uint8(colorBytes[0]) >> 4),\n      toHexDigit(uint8(colorBytes[0]) & 0x0f),\n      toHexDigit(uint8(colorBytes[1]) >> 4),\n      toHexDigit(uint8(colorBytes[1]) & 0x0f),\n      toHexDigit(uint8(colorBytes[2]) >> 4),\n      toHexDigit(uint8(colorBytes[2]) & 0x0f)\n    ));\n\n    return colorHex;\n  }\n\n  // Helper function to convert a uint8 to a hex character\n  function toHexDigit(uint8 d) internal pure returns (bytes1) {\n    if (d < 10) {\n      return bytes1(uint8(bytes1(\'0\')) + d);\n    } else {\n      return bytes1(uint8(bytes1(\'a\')) + d - 10);\n    }\n  }\n}\n')),(0,o.kt)("hr",null))}u.isMDXComponent=!0},76545:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/car-color-nft-d48161d4bbb733d828a8007d41443cfe.gif"},44288:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/get-nft-colors-1675e25c59f57e753191a0eff96d50fe.png"},46517:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/hex-to-linear-color-d98877aefdd3ecdc7c4be45eb04a35da.png"},81030:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/import-image-instance-f7bc97729956330f6dad4ec55da10790.png"},2258:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/open-thirdweb-manager-9c9db4886fbf93514d4ba51c25aaf6b0.png"},51890:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/open-unreal-project-c9b27f6fe1af07cb974341b747c9383a.png"},10187:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/perform-nft-claim-58f7faedd47176447c181b23aad60e1d.png"},33745:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/play-button-cf941c7f6f965fd19394f4c96519aa46.png"},89287:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/scene-game-bdeb53f41160012310f102a34e16bd23.png"},61315:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/token-airdrop-dashboard-3355a7fb49ac7f2a3485032a747fdf50.png"}}]);