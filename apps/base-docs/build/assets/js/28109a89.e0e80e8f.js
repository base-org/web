"use strict";(self.webpackChunk_app_base_docs=self.webpackChunk_app_base_docs||[]).push([[7574],{30876:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(2784);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||u[m]||o;return n?a.createElement(h,s(s({ref:t},d),{},{components:n})):a.createElement(h,s({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:r,s[1]=i;for(var p=2;p<o;p++)s[p]=n[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3009:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=n(7896),r=(n(2784),n(30876));const o={title:"Farcaster Frames: Building an NFT airdrop Frame",slug:"/farcaster-frames-nft-minting",description:"A tutorial that teaches how to make a Farcaster Frame that allows you to mint and airdrop NFTs to users.",author:"briandoyle81",keywords:["Solidity","ERC-721","token","NFT","farcaster","frames","farcaster frames"],tags:["frames","nft"],difficulty:"beginner",hide_table_of_contents:!1,displayed_sidebar:null},s=void 0,i={unversionedId:"docs/farcaster-frames-nft-minting",id:"docs/farcaster-frames-nft-minting",title:"Farcaster Frames: Building an NFT airdrop Frame",description:"A tutorial that teaches how to make a Farcaster Frame that allows you to mint and airdrop NFTs to users.",source:"@site/tutorials/docs/3_farcaster-frames-nft-minting.md",sourceDirName:"docs",slug:"/farcaster-frames-nft-minting",permalink:"/tutorials/farcaster-frames-nft-minting",draft:!1,tags:[{label:"frames",permalink:"/tutorials/tags/frames"},{label:"nft",permalink:"/tutorials/tags/nft"}],version:"current",sidebarPosition:3,frontMatter:{title:"Farcaster Frames: Building an NFT airdrop Frame",slug:"/farcaster-frames-nft-minting",description:"A tutorial that teaches how to make a Farcaster Frame that allows you to mint and airdrop NFTs to users.",author:"briandoyle81",keywords:["Solidity","ERC-721","token","NFT","farcaster","frames","farcaster frames"],tags:["frames","nft"],difficulty:"beginner",hide_table_of_contents:!1,displayed_sidebar:null}},l={},p=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"ERC-721 Tokens",id:"erc-721-tokens",level:3},{value:"Onchain App Development",id:"onchain-app-development",level:3},{value:"Vercel",id:"vercel",level:3},{value:"Farcaster",id:"farcaster",level:3},{value:"Setup and Testing the Template",id:"setup-and-testing-the-template",level:2},{value:"Testing the Cast",id:"testing-the-cast",level:3},{value:"Building A Mint Frame",id:"building-a-mint-frame",level:2},{value:"The Image Route",id:"the-image-route",level:3},{value:"Setting up the Contract",id:"setting-up-the-contract",level:2},{value:"Updating the Frame",id:"updating-the-frame",level:2},{value:"Showing the Real NFT Image",id:"showing-the-real-nft-image",level:2},{value:"Adjusting the Image Ratio",id:"adjusting-the-image-ratio",level:3},{value:"Conclusion",id:"conclusion",level:2}],d={toc:p},c="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(c,(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://warpcast.notion.site/Farcaster-Frames-4bd47fe97dc74a42a48d3a234636d8c5"},"Frames")," have taken the ",(0,r.kt)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," world by storm. They allow you to place a small onchain app inside of a cast! In this tutorial, we'll show you how to build your first frame using ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit"),", and our ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Zizzamia/a-frame-in-100-lines"},"a-frame-in-100-lines")," template."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"objectives"},"Objectives"),(0,r.kt)("p",null,"By the end of this tutorial you should be able to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Build a ",(0,r.kt)("a",{parentName:"li",href:"https://www.farcaster.xyz/"},"Farcaster")," Frame with a mint and airdrop function"),(0,r.kt)("li",{parentName:"ul"},"Use the ",(0,r.kt)("a",{parentName:"li",href:"https://basescan.org/"},"BaseScan")," API to find the owner of an NFT"),(0,r.kt)("li",{parentName:"ul"},"Pull the ",(0,r.kt)("inlineCode",{parentName:"li"},"tokenUri")," from a contract and use it to show the real art for an NFT")),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"erc-721-tokens"},"ERC-721 Tokens"),(0,r.kt)("p",null,"This tutorial assumes that you are able to write, test, and deploy your own ERC-721 tokens using the Solidity programming language. If you need to learn that first, check out our content in ",(0,r.kt)("a",{parentName:"p",href:"https://docs.base.org/base-camp/docs/welcome"},"Base Camp")," or the sections specific to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.base.org/base-camp/docs/erc-721-token/erc-721-standard-video"},"ERC-721 Tokens"),"!"),(0,r.kt)("h3",{id:"onchain-app-development"},"Onchain App Development"),(0,r.kt)("p",null,"You'll need to be comfortable building onchain apps."),(0,r.kt)("h3",{id:"vercel"},"Vercel"),(0,r.kt)("p",null,"You'll need to be comfortable deploying your app to ",(0,r.kt)("a",{parentName:"p",href:"https://vercel.com"},"Vercel"),", or using another solution on your own."),(0,r.kt)("h3",{id:"farcaster"},"Farcaster"),(0,r.kt)("p",null,"You must have a ",(0,r.kt)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," account with a connected wallet. Check out the ",(0,r.kt)("a",{parentName:"p",href:"https://warpcast.com/~/channel/base"},"Base channel")," to stay in the loop when we release tutorials like this!"),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"setup-and-testing-the-template"},"Setup and Testing the Template"),(0,r.kt)("p",null,"Start by creating a new repo, using ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Zizzamia/a-frame-in-100-lines"},"a-frame-in-100-lines")," as a template."),(0,r.kt)("p",null,"Run ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn install"),", then ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn dev"),"."),(0,r.kt)("p",null,"In the browser, open ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:3000/"),". All you'll see is a heading with ",(0,r.kt)("em",{parentName:"p"},"Zizzamia.xyz"),". This is expected!"),(0,r.kt)("p",null,"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"page.tsx"),". Here, you'll find the initial setup of the metadata that Farcaster reads to create the frame, as well as the simple page you just viewed. Change the heading to use your name."),(0,r.kt)("p",null,"Long term, you'd probably want to put something there, as the cast ",(0,r.kt)("strong",{parentName:"p"},"must")," have a link to this page. Currently, it's pretty common for the community to just skip that part. The cool stuff is in the Frame!"),(0,r.kt)("p",null,"Deploy your project with ",(0,r.kt)("a",{parentName:"p",href:"https://vercel.com"},"Vercel"),", then open it at the root. Again, you'll see the simple page, now with your name!"),(0,r.kt)("h3",{id:"testing-the-cast"},"Testing the Cast"),(0,r.kt)("p",null,"To cast a frame, you'd simply paste this URL into when you create a cast, and it will work automagically!"),(0,r.kt)("p",null,"But you probably want to use the ",(0,r.kt)("a",{parentName:"p",href:"https://warpcast.com/~/developers/frames"},"Frame Validator")," first. Open that up, and paste in your link. Click ",(0,r.kt)("inlineCode",{parentName:"p"},"Load"),". You should see:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Example",src:n(14076).Z,width:"1024",height:"636"})),(0,r.kt)("p",null,"Click, and the image will change. You'll also see a new set of buttons, demonstrating some of the features available for frame development."),(0,r.kt)("p",null,"Open up ",(0,r.kt)("inlineCode",{parentName:"p"},"api/frame/route.ts"),". This file handles the route in ",(0,r.kt)("inlineCode",{parentName:"p"},"post_url")," that is called when you click the button."),(0,r.kt)("p",null,"The route:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Uses ",(0,r.kt)("inlineCode",{parentName:"li"},"getFrameMessage")," from ",(0,r.kt)("inlineCode",{parentName:"li"},"onchainkit")," to validate and interpret the request"),(0,r.kt)("li",{parentName:"ul"},"Pulls the user's wallet address, and other useful information, from the ",(0,r.kt)("inlineCode",{parentName:"li"},"message")),(0,r.kt)("li",{parentName:"ul"},"Sends a ",(0,r.kt)("inlineCode",{parentName:"li"},"NextResponse")," containing a new frame, which is then displayed to the user")),(0,r.kt)("h2",{id:"building-a-mint-frame"},"Building A Mint Frame"),(0,r.kt)("p",null,"You can put a ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/farcaster-frames-transactions"},"transaction in a frame")," and require users to pay gas to mint your NFT. Another option is to airdrop NFTs to your users, with you paying the gas. This tutorial takes the second approach."),(0,r.kt)("p",null,"The strategy uses the contract from the ",(0,r.kt)("a",{parentName:"p",href:"/tutorials/onchain-nfts"},"Onchain NFTs")," tutorial, modified so that a designated address can mint for a provided address:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},"function mintTo(address _recipient) public onlyOwner {\n  if(counter >= maxSupply) {\n    revert MaxSupplyReached();\n  }\n  if(minted[_recipient]) {\n    revert OneMintPerAddress();\n  }\n  minted[_recipient] = true;\n  counter++;\n  _safeMint(_recipient, counter);\n}\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You should also use a ",(0,r.kt)("inlineCode",{parentName:"p"},"mintTo")," function that accepts an ",(0,r.kt)("inlineCode",{parentName:"p"},"address _recipient")," if you are doing a mint transaction button. Doing so helps Farcaster more easily scan your transaction for safety.")),(0,r.kt)("p",null,"You'll also want to keep track of addresses that have already minted, to prevent a few spammers from claiming all the NFTs!"),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Make sure you added ",(0,r.kt)("inlineCode",{parentName:"p"},".env.local")," to `",(0,r.kt)("inlineCode",{parentName:"p"},".gitignore"),"! ",(0,r.kt)("strong",{parentName:"p"},"If you don't do this you are going to expose your key and lose your wallet!"))),(0,r.kt)("p",null,"Create ",(0,r.kt)("inlineCode",{parentName:"p"},".env.local")," and add:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"BASESCAN_API_KEY - ",(0,r.kt)("a",{parentName:"li",href:"https://basescan.org/myapikey"},"https://basescan.org/myapikey")),(0,r.kt)("li",{parentName:"ul"},"NFT_CONTRACT_ADDRESS - As described above"),(0,r.kt)("li",{parentName:"ul"},"WALLET_PRIVATE_KEY - the private key of the wallet that owns the above NFT contract and can mint it. ",(0,r.kt)("strong",{parentName:"li"},"This key is the same as your 12-word phrase"))),(0,r.kt)("p",null,"Install ",(0,r.kt)("em",{parentName:"p"},"dotenv")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn add dotenv"),", then open ",(0,r.kt)("inlineCode",{parentName:"p"},"route.ts"),"."),(0,r.kt)("p",null,"Add a new image in the ",(0,r.kt)("inlineCode",{parentName:"p"},"public")," folder. Per the ",(0,r.kt)("a",{parentName:"p",href:"https://warpcast.notion.site/Farcaster-Frames-4bd47fe97dc74a42a48d3a234636d8c5"},"Frames")," docs, images must have a 1.91 to 1, or a 1 to 1 aspect ratio. We used a grey-scale copy of the NFT, but some frame developers prefer to show the full image, or another call to action."),(0,r.kt)("p",null,"For now, just use something you'll recognize as a placeholder."),(0,r.kt)("p",null,"In ",(0,r.kt)("inlineCode",{parentName:"p"},"app/config.ts"),", change ",(0,r.kt)("inlineCode",{parentName:"p"},"NEXT_PUBLIC_URL")," to the address where you've deployed your site."),(0,r.kt)("p",null,"Change the image link in both files to the new image you added in ",(0,r.kt)("inlineCode",{parentName:"p"},"public"),". Next automatically makes these available at ",(0,r.kt)("inlineCode",{parentName:"p"},"your-site.vercel.app/your-image.png"),"."),(0,r.kt)("p",null,"Redeploy and test the Frame again."),(0,r.kt)("p",null,"You'll see the new image, but only in the validator, or for new casts. Any existing casts with the frame will permanently display the old image. These can ",(0,r.kt)("strong",{parentName:"p"},"not")," be updated."),(0,r.kt)("h3",{id:"the-image-route"},"The Image Route"),(0,r.kt)("p",null,"If your NFTs are unique, you'll want to get the picture of the actual NFT once the user mints. If you're not using unique NFTs, skip this part. It's more efficient to keep a local copy of the art in ",(0,r.kt)("inlineCode",{parentName:"p"},"public")," and save some API calls."),(0,r.kt)("p",null,"Add a route to get the image. Right now, this can just return the existing image:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { NextResponse } from 'next/server';\n\nexport async function GET() {\n  // Temporary, does NOT fetch the correct image for the actual NFT\n  const img = await fetch('https://land-sea-and-sky.vercel.app/lss-bw.png').then((res) =>\n    res.blob(),\n  );\n  return new NextResponse(img, {\n    status: 200,\n    headers: {\n      'Content-Type': 'image/png',\n      'Cache-Control': 'max-age=10',\n    },\n  });\n}\n")),(0,r.kt)("p",null,"Update both ",(0,r.kt)("inlineCode",{parentName:"p"},"route.ts")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"page.tsx")," to use this route for the image:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// page.tsx\nconst imageUrl = `${NEXT_PUBLIC_URL}/api/images/nft`;\n\nconst frameMetadata = getFrameMetadata({\n  buttons: [\n    {\n      label: 'Story time',\n    },\n    {\n      action: 'tx',\n      label: 'Send Base Sepolia',\n      target: `${NEXT_PUBLIC_URL}/api/tx`,\n      postUrl: `${NEXT_PUBLIC_URL}/api/tx-success`,\n    },\n  ],\n  image: {\n    src: imageUrl,\n    aspectRatio: '1.91:1',\n  },\n  input: {\n    text: 'Tell me a story',\n  },\n  postUrl: `${NEXT_PUBLIC_URL}/api/frame`,\n});\n\nexport const metadata: Metadata = {\n  title: 'zizzamia.xyz',\n  description: 'LFG',\n  openGraph: {\n    title: 'zizzamia.xyz',\n    description: 'LFG',\n    images: [imageUrl],\n  },\n  other: {\n    ...frameMetadata,\n  },\n};\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// route.ts\nreturn new NextResponse(\n  getFrameHtmlResponse({\n    buttons: [\n      {\n        label: `State: ${state?.page || 0}`,\n      },\n      {\n        action: 'link',\n        label: 'OnchainKit',\n        target: 'https://onchainkit.xyz',\n      },\n      {\n        action: 'post_redirect',\n        label: 'Dog pictures',\n      },\n    ],\n    image: {\n      src: imgUrl,\n    },\n    postUrl: `${NEXT_PUBLIC_URL}/api/frame`,\n    state: {\n      page: state?.page + 1,\n      time: new Date().toISOString(),\n    },\n  }),\n);\n")),(0,r.kt)("p",null,"Redeploy and test!"),(0,r.kt)("h2",{id:"setting-up-the-contract"},"Setting up the Contract"),(0,r.kt)("p",null,"Import your deployment artifact, if you're using Hardhat. If you're using Foundry, or another tool, adapt as appropriate to get the ABI and contract address."),(0,r.kt)("p",null,"Add your wallet key, and a provider url to your `",(0,r.kt)("inlineCode",{parentName:"p"},".env.local"),", then import them as well."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import LandSeaSkyNFT from '../constants/LandSeaSkyNFT.json';\n\nrequire('dotenv').config();\n\nconst WALLET_PRIVATE_KEY = process.env.WALLET_PRIVATE_KEY;\nconst PROVIDER_URL = process.env.PROVIDER_URL;\n")),(0,r.kt)("p",null,"Install ",(0,r.kt)("a",{parentName:"p",href:"https://viem.sh/"},"viem")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn add viem"),"."),(0,r.kt)("p",null,"Import:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { privateKeyToAccount } from 'viem/accounts';\nimport { baseSepolia } from 'viem/chains';\nimport { createWalletClient, http } from 'viem';\n")),(0,r.kt)("p",null,"Create a ",(0,r.kt)("inlineCode",{parentName:"p"}," walletClient")," from the account, created from the private key, and a ",(0,r.kt)("inlineCode",{parentName:"p"},"publicClient")," to read from the blockchain."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const nftOwnerAccount = privateKeyToAccount(WALLET_PRIVATE_KEY as `0x${string}`);\nconst nftOwnerClient = createWalletClient({\n  account: nftOwnerAccount,\n  chain: baseSepolia,\n  transport: http(PROVIDER_URL as string),\n});\n\nconst publicClient = createPublicClient({\n  chain: baseSepolia,\n  transport: http(PROVIDER_URL as string),\n});\n")),(0,r.kt)("p",null,"Use the address of the Farcaster user, conveniently provided by OnchainKit, to check whether or not the user has minted the NFT:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"let minted = false;\n\ntry {\n  minted = !!(await publicClient.readContract({\n    address: LandSeaSkyNFT.address as `0x${string}`,\n    abi: LandSeaSkyNFT.abi,\n    functionName: 'minted',\n    args: [message.address],\n  }));\n} catch (err) {\n  console.error(err);\n}\n")),(0,r.kt)("p",null,"The double !! will force the response into a boolean."),(0,r.kt)("h2",{id:"updating-the-frame"},"Updating the Frame"),(0,r.kt)("p",null,"If the address has already minted an NFT, update the button to share a message thanking them, otherwise, try to mint and airdrop an NFT:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"if (minted) {\n  return new NextResponse(\n    getFrameHtmlResponse({\n      buttons: [\n        {\n          label: 'You already minted, thanks!',\n        },\n      ],\n      image: imageUrl,\n    }),\n  );\n} else {\n  // Try to mint and airdrop the NFT\n  try {\n    const { request } = await publicClient.simulateContract({\n      account: nftOwnerAccount,\n      address: LandSeaSkyNFT.address as `0x${string}`,\n      abi: LandSeaSkyNFT.abi,\n      functionName: 'mintTo',\n      args: [message.address],\n    });\n    await nftOwnerClient.writeContract(request);\n  } catch (err) {\n    console.error(err);\n  }\n  if (minted) {\n  return new NextResponse(\n    getFrameHtmlResponse({\n      buttons: [\n        {\n          label: 'Thanks for minting!',\n        },\n      ],\n      image: imageUrl,\n    }),\n  );\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Update your environment variables in Vercel")," then redeploy and test. You won't see a different image, but you'll be able to see the transactions on ",(0,r.kt)("a",{parentName:"p",href:"https://basescan.org/"},"BaseScan"),"."),(0,r.kt)("h2",{id:"showing-the-real-nft-image"},"Showing the Real NFT Image"),(0,r.kt)("p",null,"Now, it's time to make the frame show the user's NFT, if they have one. Because ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/base-org/land-sea-and-sky"},"Land, Sea, and Sky"),", the sample from ","[Complex Onchain NFTs]"," generates a unique NFT for each user, you'll need to use a third-party api to get the user's NFT id, then fetch the tokenURI for that NFT."),(0,r.kt)("p",null,"First, change your button on the first page to represent the new use case: ",(0,r.kt)("inlineCode",{parentName:"p"},'"Mint or View NFT"'),"."),(0,r.kt)("p",null,"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"route.ts")," for the image endpoint."),(0,r.kt)("p",null,"Update it to grab query parameters from your endpoint, and show the grayscale image if either is missing:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const url = new URL(req.url);\n  const queryParams = url.searchParams;\n\n  const { minted, address } = Object.fromEntries(queryParams.entries());\n  console.log({ minted, address });\n\n\n  if (!minted || !address) {\n      const img = await fetch('https://land-sea-and-sky.vercel.app/lss-bw.png').then((res) => res.blob());\n      return new NextResponse(img, {\n          status: 200,\n          headers: {\n              'Content-Type': 'image/png',\n              'Cache-Control': 'max-age=10',\n          }\n      });\n  } else {\n      // Find out if the address still owns the NFT, and if so, what the token ID is\n\n  }\n}\n\n")),(0,r.kt)("p",null,"You'll use the BaseScan api to find the token information. Add your api key to your ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," if you didn't already."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Note that BaseScan and Etherscan use different keys!")),(0,r.kt)("p",null,"There isn't an sdk to install."),(0,r.kt)("p",null,"Add a folder inside ",(0,r.kt)("inlineCode",{parentName:"p"},"app")," called ",(0,r.kt)("inlineCode",{parentName:"p"},"types")," and a file called ",(0,r.kt)("inlineCode",{parentName:"p"},"index.ts")," inside that. Add the types for etherscan api responses:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// @dev values taken from sample response\nexport type BaseScanEventResponse = {\n  blockNumber: string;\n  timeStamp: string;\n  hash: string;\n  nonce: string;\n  blockHash: string;\n  from: string;\n  contractAddress: string;\n  to: string;\n  tokenID: string;\n  tokenName: string;\n  tokenSymbol: string;\n  tokenDecimal: string;\n  transactionIndex: string;\n  gas: string;\n  gasPrice: string;\n  gasUsed: string;\n  cumulativeGasUsed: string;\n  input: string;\n  confirmations: string;\n};\n\nexport type BaseScanResponse = {\n  status: '0' | '1';\n  message: string;\n  result: BaseScanEventResponse[];\n};\n")),(0,r.kt)("p",null,"Import these into the image route:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"import { BaseScanResponse } from '../../../types';\n")),(0,r.kt)("p",null,"Use the BaseScan API to get a list of ERC721 Transfer Events for the address for the contract, filter that list to remove any NFT ids that were given away."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"if (!minted || !address) {\n  // Send the grayscale image\n} else {\n  // Find out of the address still owns the NFT, and if so, what the token ID is\n  const API_URL = `https://api-sepolia.basescan.org/api?module=account&action=tokennfttx&contractaddress=${LandSeaSkyNFT.address}&address=${address}&sort=asc&apikey=${BASESCAN_API_KEY}`;\n  const response = await fetch(API_URL);\n  const json: BaseScanResponse = (await response.json()) as BaseScanResponse;\n\n  const result = json.result;\n\n  // Create a list of the token IDs where to matches the address\n  const tokenIds = result\n    .filter((tx) => tx.to === address.toLocaleLowerCase())\n    .map((tx) => tx.tokenID);\n\n  // Create a list of the token IDs where from matches the address\n  const tokenIdsFrom = result\n    .filter((tx) => tx.from === address.toLocaleLowerCase())\n    .map((tx) => tx.tokenID);\n\n  // Remove any token IDS that are in tokenIdsFrom from tokenIds\n  const tokenIdsTo = tokenIds.filter((tokenId) => !tokenIdsFrom.includes(tokenId));\n}\n")),(0,r.kt)("p",null,"Add another image, to handle users that have minted your NFT, but don't anymore. We used a sad whale:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Sad Whale",src:n(57300).Z,width:"503",height:"266"})),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"if (tokenIdsTo.length === 0) {\n  const img = await fetch('https://land-sea-and-sky.vercel.app/gave-me-away.png').then((res) =>\n    res.blob(),\n  );\n  return new NextResponse(img, {\n    status: 200,\n    headers: {\n      'Content-Type': 'image/png',\n      'Cache-Control': 'max-age=10',\n    },\n  });\n} else {\n  // Get the actual NFT image from the contract\n}\n")),(0,r.kt)("p",null,"Otherwise, create a viem public client and call tokenURI with the id of the first token on the list"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": This is not an elegant solution for if someone is gifted an NFT then mints their own!"),(0,r.kt)("p",null,"You did this already in api/frame. Use the same pattern, but instead call ",(0,r.kt)("inlineCode",{parentName:"p"},"tokenURI")," with the token id:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// Get the actual NFT image from the contract\nconst publicClient = createPublicClient({\n  chain: baseSepolia,\n  transport: http(PROVIDER_URL as string),\n});\n\nlet tokenMetadata = '';\ntry {\n  tokenMetadata = (await publicClient.readContract({\n    address: LandSeaSkyNFT.address as `0x${string}`,\n    abi: LandSeaSkyNFT.abi,\n    functionName: 'tokenURI',\n    args: [tokenIdsTo[0]],\n  })) as string;\n} catch (err) {\n  console.error(err);\n}\n\nconsole.log({ tokenMetadata });\n")),(0,r.kt)("p",null,"The tokenURI for the sample contract returns the actual json metadata, json encoded, with the actual svg inside, also base64 encoded. You'll need to decode it, then return it."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// Decode the base64 encoded JSON\nconst tokenMetadataJson = JSON.parse(atob(tokenMetadata.split(',')[1]));\n\n// Then decode the base64 encoded svg image\nconst svg = atob(tokenMetadataJson.image.split(',')[1]);\n\n// Create a blob from the svg\nconst img = new Blob([svg], { type: 'image/svg+xml' });\n\n// Return the blob\nreturn new NextResponse(img, {\n  status: 200,\n  headers: {\n    'Content-Type': 'image/svg+xml',\n    'Cache-Control': 'max-age=10',\n  },\n});\n")),(0,r.kt)("p",null,"This works!"),(0,r.kt)("h3",{id:"adjusting-the-image-ratio"},"Adjusting the Image Ratio"),(0,r.kt)("p",null,"Farcaster Frames now allow a 1:1 image ratio, but they used to only accept a 1:91 to 1 ratio. You can skip this if you don't want the classic look."),(0,r.kt)("p",null,"If you do want to go old-school, you'll need to adjust the svg, and clip the extra content, since the svg has pieces that are intended to be out of frame:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'function frameSvgStringToBlob(originalSvgString: string): Blob {\n  // Define the dimensions based on the 1.91:1 aspect ratio\n  const originalSize = 1024;\n  const newWidth = originalSize * 1.91; // 1955.84\n  const centerX = newWidth / 2;\n  const clipStartX = centerX - 512; // Start of the clip rectangle\n\n  // Create the new SVG string and add a clipPath to clip the contents\n  const framedSvgString = `\n     <svg width="${newWidth}" height="${originalSize}" viewBox="0 0 ${newWidth} ${originalSize}" xmlns="http://www.w3.org/2000/svg">\n       <defs>\n         <clipPath id="clip">\n           \x3c!-- Set the clipping rectangle to start at clipStartX and be 1024 units wide --\x3e\n           <rect x="${clipStartX}" width="1024" height="${originalSize}" />\n         </clipPath>\n       </defs>\n       <g clip-path="url(#clip)">\n         ${originalSvgString}\n       </g>\n     </svg>\n   `;\n\n  // Convert the string to a blob\n  const blob = new Blob([framedSvgString], { type: \'image/svg+xml\' });\n\n  return blob;\n}\n')),(0,r.kt)("p",null,"Call your new function, then return it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"const img = new Blob([frameSvgStringToBlob(svg)], { type: 'image/svg+xml' });\n// Return the blob\nreturn new NextResponse(img, {\n  status: 200,\n  headers: {\n    'Content-Type': 'image/svg+xml',\n    'Cache-Control': 'max-age=10',\n  },\n});\n")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"SVG images aren't working in Frames on mobile clients. Stay tuned on the Base channel for a fix! Or add a library here to return the image as a ",(0,r.kt)("inlineCode",{parentName:"p"},".png")," instead of a ",(0,r.kt)("inlineCode",{parentName:"p"},".svg"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Remember to update your envars in Vercel"),", redeploy, and test. You'll now see your NFT in the frame!"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Real NFT",src:n(34646).Z,width:"1024",height:"333"})),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"In this tutorial, you learned how to create ",(0,r.kt)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," frames. You then updated it to airdrop an NFT to users who click the button in your frame. Finally, you learned how to pull real NFT images from the blockchain, and display them in your frames."),(0,r.kt)("hr",null))}u.isMDXComponent=!0},57300:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/gave-me-away-ddedeeb469331a73f329f6b488ace747.png"},34646:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/real-nft-fecccc40f7c95a128329156a5ad4f07e.png"},14076:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/updated-100-lines-ce333f5e36f5cfe8dddd43f15d3d8383.png"}}]);