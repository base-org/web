"use strict";(self.webpackChunk_app_base_docs=self.webpackChunk_app_base_docs||[]).push([[516],{82247:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>g});var a=n(14041);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,g=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},13622:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(89575),r=(n(14041),n(82247));const o={title:"Farcaster Frames: Making transactions",slug:"/farcaster-frames-transactions",description:"A tutorial that teaches how to invoke a wallet transaction from a Farcaster Frame.",author:"briandoyle81",keywords:["farcaster","frames","farcaster frames","wallet","transaction","Base"],tags:["frames"],difficulty:"intermediate",hide_table_of_contents:!1,displayed_sidebar:null},i=void 0,s={unversionedId:"docs/farcaster-frames-transactions",id:"docs/farcaster-frames-transactions",title:"Farcaster Frames: Making transactions",description:"A tutorial that teaches how to invoke a wallet transaction from a Farcaster Frame.",source:"@site/tutorials/docs/3_farcaster-frames-transactions.md",sourceDirName:"docs",slug:"/farcaster-frames-transactions",permalink:"/tutorials/farcaster-frames-transactions",draft:!1,tags:[{label:"frames",permalink:"/tutorials/tags/frames"}],version:"current",sidebarPosition:3,frontMatter:{title:"Farcaster Frames: Making transactions",slug:"/farcaster-frames-transactions",description:"A tutorial that teaches how to invoke a wallet transaction from a Farcaster Frame.",author:"briandoyle81",keywords:["farcaster","frames","farcaster frames","wallet","transaction","Base"],tags:["frames"],difficulty:"intermediate",hide_table_of_contents:!1,displayed_sidebar:null}},l={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Onchain App Development",id:"onchain-app-development",level:3},{value:"Vercel",id:"vercel",level:3},{value:"Farcaster",id:"farcaster",level:3},{value:"Frames",id:"frames",level:3},{value:"Smart Contracts",id:"smart-contracts",level:3},{value:"An Overview of the Transaction Process",id:"an-overview-of-the-transaction-process",level:2},{value:"Setting up the Smart Contract",id:"setting-up-the-smart-contract",level:2},{value:"Building the Frame",id:"building-the-frame",level:2},{value:"The First Frame and Page",id:"the-first-frame-and-page",level:3},{value:"Adding the Transaction Endpoints",id:"adding-the-transaction-endpoints",level:2},{value:"Setting up the Transaction Endpoint",id:"setting-up-the-transaction-endpoint",level:3},{value:"Setting Up the After Transaction Endpoint",id:"setting-up-the-after-transaction-endpoint",level:3},{value:"Conclusion",id:"conclusion",level:2},{value:"Click the Button Source Code",id:"click-the-button-source-code",level:2}],p={toc:c},u="wrapper";function d(e){let{components:t,...n}=e;return(0,r.yg)(u,(0,a.A)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://warpcast.notion.site/Farcaster-Frames-4bd47fe97dc74a42a48d3a234636d8c5"},"Frames")," on ",(0,r.yg)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," support wallet transactions invoked directly from the buttons in a Frame! ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit")," supports this feature. In this tutorial, you'll learn how to set up a frame that will allow your users to complete a simple transaction."),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"objectives"},"Objectives"),(0,r.yg)("p",null,"By the end of this tutorial, you should be able to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Build a ",(0,r.yg)("a",{parentName:"li",href:"https://www.farcaster.xyz/"},"Farcaster")," Frame that invokes a smart contract transaction from a button")),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.yg)("h3",{id:"onchain-app-development"},"Onchain App Development"),(0,r.yg)("p",null,"You'll need to be comfortable building onchain apps."),(0,r.yg)("h3",{id:"vercel"},"Vercel"),(0,r.yg)("p",null,"You'll need to be comfortable deploying your app to ",(0,r.yg)("a",{parentName:"p",href:"https://vercel.com"},"Vercel"),", or using another solution on your own. Check out our tutorial on ",(0,r.yg)("a",{parentName:"p",href:"/tutorials/farcaster-frames-deploy-to-vercel"},"deploying with Vercel")," if you need a refresher!"),(0,r.yg)("h3",{id:"farcaster"},"Farcaster"),(0,r.yg)("p",null,"You must have a ",(0,r.yg)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," account with a connected wallet. Check out the ",(0,r.yg)("a",{parentName:"p",href:"https://warpcast.com/~/channel/base"},"Base channel")," to stay in the loop when we release tutorials like this!"),(0,r.yg)("h3",{id:"frames"},"Frames"),(0,r.yg)("p",null,"You should be comfortable with the basics of creating Farcaster ",(0,r.yg)("a",{parentName:"p",href:"https://warpcast.notion.site/Farcaster-Frames-4bd47fe97dc74a42a48d3a234636d8c5"},"Frames"),". If you aren't, check out our tutorials for how to build a ",(0,r.yg)("a",{parentName:"p",href:"/tutorials/farcaster-frames-nocode-minting"},"no-code NFT mint Frame")," or ",(0,r.yg)("a",{parentName:"p",href:"/tutorials/farcaster-frames-nft-minting"},"NFT airdrop Frame"),"."),(0,r.yg)("h3",{id:"smart-contracts"},"Smart Contracts"),(0,r.yg)("p",null,"You'll need a smart contract with at least one ",(0,r.yg)("inlineCode",{parentName:"p"},"public")," function that is ",(0,r.yg)("strong",{parentName:"p"},"not")," ",(0,r.yg)("inlineCode",{parentName:"p"},"pure")," or ",(0,r.yg)("inlineCode",{parentName:"p"},"view"),". It needs to change state, so that it costs gas to execute. You can use your own, or the one that we've provided below."),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"an-overview-of-the-transaction-process"},"An Overview of the Transaction Process"),(0,r.yg)("p",null,"As outlined in the ",(0,r.yg)("a",{parentName:"p",href:"https://www.notion.so/warpcast/Frame-Transactions-Public-Draft-v2-9d9f9f4f527249519a41bd8d16165f73"},"Public Draft V2"),", transactions in frames work through a multi-step process between the frame developer's endpoint, and the Warpcast (or other) app. A slightly more detailed breakdown of the process:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Any frame can have a button with ",(0,r.yg)("inlineCode",{parentName:"li"},"'tx'")," assigned as the ",(0,r.yg)("inlineCode",{parentName:"li"},"action"),". If this is the case, the ",(0,r.yg)("inlineCode",{parentName:"li"},"target")," must be a URL for an endpoint that can process the request, and return ",(0,r.yg)("inlineCode",{parentName:"li"},"calldata")," for an onchain transaction"),(0,r.yg)("li",{parentName:"ol"},"When the user clicks the button, a POST request is sent to the endpoint with the usual set of data you get from the frame"),(0,r.yg)("li",{parentName:"ol"},"The endpoint uses that data, such as the user's attached wallet address, to build a transaction and send it back to the Farcaster client app"),(0,r.yg)("li",{parentName:"ol"},"The app then redirects the user to their wallet with the provided ",(0,r.yg)("inlineCode",{parentName:"li"},"calldata"),", which opens the normal flow for the user to review and approve or deny a transaction"),(0,r.yg)("li",{parentName:"ol"},"If successful, the wallet returns the user to the app with the transaction id"),(0,r.yg)("li",{parentName:"ol"},"The app then automatically makes another POST request to the ",(0,r.yg)("strong",{parentName:"li"},"same")," ",(0,r.yg)("inlineCode",{parentName:"li"},"target"),", this time with the transaction id. ",(0,r.yg)("strong",{parentName:"li"},"Make sure you handle this second call appropriately!"))),(0,r.yg)("h2",{id:"setting-up-the-smart-contract"},"Setting up the Smart Contract"),(0,r.yg)("p",null,"Before you can build a frame that calls a smart contract transaction, you need to have a smart contract! You can use your own, deploy your own copy of our ",(0,r.yg)("em",{parentName:"p"},"Click the Button")," smart contract, or use our deployment."),(0,r.yg)("p",null,'The contract contains a simple game where players can "click the button" and pay a few cents worth of ether to get a point. That\'s it! No rewards, no complexity, just a tempting big red button, and a leaderboard that can be retrieved ',(0,r.yg)("strong",{parentName:"p"},"unsorted"),"."),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"function clickTheButton()"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"public")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"payable")),(0,r.yg)("li",{parentName:"ul"},"Cost is 10000 gwei, or 0.00001 ether"),(0,r.yg)("li",{parentName:"ul"},"Adds 1 point to the score of ",(0,r.yg)("inlineCode",{parentName:"li"},"msg.sender")))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"function getMyClicks()"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"public")),(0,r.yg)("li",{parentName:"ul"},"Returns the number of clicks for ",(0,r.yg)("inlineCode",{parentName:"li"},"msg.sender")))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"function getAllClicks()"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"public")),(0,r.yg)("li",{parentName:"ul"},"Returns an ",(0,r.yg)("strong",{parentName:"li"},"unsorted")," list of each address and their score"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"function withdraw()"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"public")," and ",(0,r.yg)("inlineCode",{parentName:"li"},"onlyOwner")),(0,r.yg)("li",{parentName:"ul"},"Withdraw all funds to the owner address")))),(0,r.yg)("p",null,"We've deployed an ",(0,r.yg)("a",{parentName:"p",href:"https://sepolia.basescan.org/address/0x863632e7607150d550a92502c0375802047eaa48#code"},"instance of the contract")," on testnet, and ",(0,r.yg)("a",{parentName:"p",href:"https://basescan.org/address/0x303e6ea2b939ce1be24ab16d66020696097910af#code"},"on mainnet"),". You can use this if you like."),(0,r.yg)("h2",{id:"building-the-frame"},"Building the Frame"),(0,r.yg)("p",null,"Start a new project using ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/Zizzamia/a-frame-in-100-lines"},"a-frame-in-100-lines")," as a template or guide, or open an existing one. Make sure the version of ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit")," is current."),(0,r.yg)("h3",{id:"the-first-frame-and-page"},"The First Frame and Page"),(0,r.yg)("p",null,"Add a new page to the Next.js ",(0,r.yg)("a",{parentName:"p",href:"https://nextjs.org/docs/app"},"App Router")," by adding a new folder in ",(0,r.yg)("inlineCode",{parentName:"p"},"app")," called ",(0,r.yg)("inlineCode",{parentName:"p"},"buttonclicker")," and a file called ",(0,r.yg)("inlineCode",{parentName:"p"},"page.tsx")," inside the new folder. Doing so will automatically place the new page at ",(0,r.yg)("inlineCode",{parentName:"p"},"yourappname.vercel.app/buttonclicker"),"."),(0,r.yg)("p",null,"Using the sample page as a guide, set up a new frame, and stub for a new page:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"import { getFrameMetadata } from '@coinbase/onchainkit/frame';\nimport type { Metadata } from 'next';\nimport { NEXT_PUBLIC_URL } from './config';\n\nconst frameMetadata = getFrameMetadata({\n  buttons: [\n    {\n      action: 'tx',\n      label: 'Click the Button',\n      target: `${NEXT_PUBLIC_URL}/api/buttonclicker`,\n    },\n    {\n      action: 'link',\n      label: 'Leaderboard',\n      target: `${NEXT_PUBLIC_URL}/buttonclicker`,\n    },\n  ],\n  image: {\n    src: `${NEXT_PUBLIC_URL}/button.webp`,\n    aspectRatio: '1:1',\n  },\n  input: {\n    text: \"Don't click the button!\",\n  },\n  postUrl: `${NEXT_PUBLIC_URL}/api/aftertx`,\n});\n\nexport const metadata: Metadata = {\n  title: 'Click the Button',\n  description: \"Don't click the button!\",\n  openGraph: {\n    title: 'Click the Button',\n    description: \"Don't click the button!\",\n    images: [`${NEXT_PUBLIC_URL}/button.webp`],\n  },\n  other: {\n    ...frameMetadata,\n  },\n};\n\nexport default function Page() {\n  return (\n    <>\n      <h1>Leaderboard</h1>\n      <p>TODO</p>\n    </>\n  );\n}\n")),(0,r.yg)("p",null,"A few notes:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"The naming conventions and organization of OnchainKit are evolving as frames evolve. Check the ",(0,r.yg)("a",{parentName:"li",href:"https://github.com/coinbase/onchainkit"},"OnchainKit")," repo and docs if the imports don't work"),(0,r.yg)("li",{parentName:"ul"},"You'll make the api endpoint for the button clicker game next"),(0,r.yg)("li",{parentName:"ul"},"Feel free to adjust the text. We're just having fun by making it give conflicting instructions"),(0,r.yg)("li",{parentName:"ul"},"The button to show the leaderboard simply goes to your page. You could render an svg to png in the frame endpoint to show it in frames as well"),(0,r.yg)("li",{parentName:"ul"},"You'll have to do the leaderboard on your own. Check out the frontend content in ",(0,r.yg)("a",{parentName:"li",href:"https://docs.base.org/base-camp/docs/welcome"},"Base Camp")," if you need a hand learning how to interact with your contracts!")),(0,r.yg)("h2",{id:"adding-the-transaction-endpoints"},"Adding the Transaction Endpoints"),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"The transaction endpoints must handle two scenarios:")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"A POST request to the endpoint providing the user's information and expecting transaction ",(0,r.yg)("inlineCode",{parentName:"li"},"calldata")," in return"),(0,r.yg)("li",{parentName:"ul"},"A POST to the ",(0,r.yg)("inlineCode",{parentName:"li"},"postUrl")," endpoint after the transaction is successful, containing the transaction id. The second POST should return a valid frame"),(0,r.yg)("li",{parentName:"ul"},"These can be the same or different endpoints")),(0,r.yg)("h3",{id:"setting-up-the-transaction-endpoint"},"Setting up the Transaction Endpoint"),(0,r.yg)("p",null,"Add a new folder called ",(0,r.yg)("inlineCode",{parentName:"p"},"buttonclicker")," containing a file called ",(0,r.yg)("inlineCode",{parentName:"p"},"route.ts")," inside the ",(0,r.yg)("inlineCode",{parentName:"p"},"api")," folder of your ",(0,r.yg)("inlineCode",{parentName:"p"},"app")," router. This will automatically create a new route at ",(0,r.yg)("inlineCode",{parentName:"p"},"https://yourapp.vercel.app/buttonclicker"),"."),(0,r.yg)("p",null,"You'll need to import the standard Frames functions you've been using, as well as some utilities from ",(0,r.yg)("a",{parentName:"p",href:"https://viem.sh/"},"viem"),". You'll also need a new ",(0,r.yg)("inlineCode",{parentName:"p"},"type")," from ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"import { FrameRequest, getFrameMessage, getFrameHtmlResponse } from '@coinbase/onchainkit/frame';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { encodeFunctionData, formatEther, parseGwei } from 'viem';\nimport { base } from 'viem/chains';\nimport type { FrameTransactionResponse } from '@coinbase/onchainkit/frame';\n")),(0,r.yg)("p",null,"Finally, you'll need to import the ABI and address for your contract. If you're using a tool that exports the ABI as an object, you can add it as below after adding the folder and file for the ABI. Make sure you have ",(0,r.yg)("inlineCode",{parentName:"p"},"const abi =")," before the array containing the ABI, and ",(0,r.yg)("inlineCode",{parentName:"p"},"export default abi;"),"."),(0,r.yg)("p",null,"You also need to add the contract address to ",(0,r.yg)("inlineCode",{parentName:"p"},"config.ts"),"."),(0,r.yg)("p",null,"If you're using Hardhat json artifacts, add those to your project and import from there."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"import ClickTheButtonABI from '../../_contracts/ClickTheButtonAbi';\nimport { CLICK_THE_BUTTON_CONTRACT_ADDR } from '../../config';\n")),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"getResponse")," function works similar to other frames. Stub it out first:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"async function getResponse(req: NextRequest): Promise<NextResponse | Response> {\n  const body: FrameRequest = await req.json();\n  const { isValid } = await getFrameMessage(body, { neynarApiKey: 'NEYNAR_ONCHAIN_KIT' });\n\n  if (!isValid) {\n    return new NextResponse('Message not valid', { status: 500 });\n  }\n\n  // TODO\n}\n\nexport async function POST(req: NextRequest): Promise<Response> {\n  return getResponse(req);\n}\n\nexport const dynamic = 'force-dynamic';\n")),(0,r.yg)("p",null,"To begin, you'll need to build the ",(0,r.yg)("inlineCode",{parentName:"p"},"data")," for the transaction. You'll use ",(0,r.yg)("inlineCode",{parentName:"p"},"encodeFunctionData")," from viem to do this, the same as any other onchain app using viem:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"const data = encodeFunctionData({\n  abi: ClickTheButtonABI,\n  functionName: 'clickTheButton',\n});\n")),(0,r.yg)("p",null,"Next, use ",(0,r.yg)("inlineCode",{parentName:"p"},"FrameTransactionResponse")," from ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit")," to build the response the app expects:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"const txData: FrameTransactionResponse = {\n  chainId: `eip155:${base.id}`,\n  method: 'eth_sendTransaction',\n  params: {\n    abi: [],\n    data,\n    to: CLICK_THE_BUTTON_CONTRACT_ADDR,\n    value: parseGwei('10000').toString(), // 0.00001 ETH\n  },\n};\n")),(0,r.yg)("p",null,"Finally, return the transaction as a ",(0,r.yg)("inlineCode",{parentName:"p"},"NextResponse"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"return NextResponse.json(txData);\n")),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"If you find Warpcast errors or spins forever after receiving your transaction data, it can be handy to simulate the transaction on your service first. It makes debugging much easier and will rule out any errors in forming the transaction arguments. To learn how, check out viem's documentation on ",(0,r.yg)("a",{parentName:"p",href:"https://viem.sh/docs/contract/simulateContract#simulatecontract"},"Simulating Contract Interactions"),".")),(0,r.yg)("h3",{id:"setting-up-the-after-transaction-endpoint"},"Setting Up the After Transaction Endpoint"),(0,r.yg)("p",null,"You can use a different ",(0,r.yg)("inlineCode",{parentName:"p"},"postUrl")," to separate concerns with generating the transaction, and returning a frame after. You've already named this endpoint ",(0,r.yg)("inlineCode",{parentName:"p"},"aftertx")," in the first frame's ",(0,r.yg)("inlineCode",{parentName:"p"},"postUrl"),". Add it now to the ",(0,r.yg)("inlineCode",{parentName:"p"},"api")," folder, and open ",(0,r.yg)("inlineCode",{parentName:"p"},"aftertx/route.ts"),"."),(0,r.yg)("p",null,"In this case, simply return the original frame with slightly updated buttons and text:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"import { FrameRequest, getFrameMessage, getFrameHtmlResponse } from '@coinbase/onchainkit/frame';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { NEXT_PUBLIC_URL } from '../../config';\n\nasync function getResponse(req: NextRequest): Promise<NextResponse> {\n  const body: FrameRequest = await req.json();\n  const { isValid, message } = await getFrameMessage(body, { neynarApiKey: 'NEYNAR_ONCHAIN_KIT' });\n\n  if (!isValid) {\n    return new NextResponse('Message not valid', { status: 500 });\n  }\n\n  return new NextResponse(\n    getFrameHtmlResponse({\n      buttons: [\n        {\n          action: 'tx',\n          label: 'Click Again!',\n          target: `${NEXT_PUBLIC_URL}/api/buttonclicker`,\n        },\n        {\n          action: 'link',\n          label: 'Leaderboard',\n          target: `${NEXT_PUBLIC_URL}/buttonclicker`,\n        },\n      ],\n      image: {\n        src: `${NEXT_PUBLIC_URL}/button.webp`,\n        aspectRatio: '1:1',\n      },\n      input: {\n        text: 'Noooo, why did you click!?',\n      },\n      postUrl: `${NEXT_PUBLIC_URL}/api/aftertx`,\n    }),\n  );\n}\n\nexport async function POST(req: NextRequest): Promise<Response> {\n  return getResponse(req);\n}\n\nexport const dynamic = 'force-dynamic';\n")),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},"In certain applications you might want to monitor the status of the transaction at this point. It's possible it fails, takes a while, and/or you may want to do another operation ",(0,r.yg)("em",{parentName:"p"},"only after")," it has been confirmed. To do so you can make use of ",(0,r.yg)("inlineCode",{parentName:"p"},"message.transaction.hash")," and build a frame flow that checks the status of the transaction by fetching the ",(0,r.yg)("a",{parentName:"p",href:"https://viem.sh/docs/actions/public/getTransactionReceipt#gettransactionreceipt"},"transaction receipt"),".")),(0,r.yg)("h2",{id:"conclusion"},"Conclusion"),(0,r.yg)("p",null,"In this tutorial, you've learned how to invoke a smart contract transaction from a frame! You used it to implement a simple game."),(0,r.yg)("h2",{id:"click-the-button-source-code"},"Click the Button Source Code"),(0,r.yg)("p",null,"This contract uses Remix-style imports. You'll need to update them for other toolchains!"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-solidity"},'// SPDX-License-Identifier: MIT\n\nimport "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/structs/EnumerableMap.sol";\nimport "https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/access/Ownable.sol";\n\npragma solidity 0.8.20;\n\nerror WrongValue();\n\ncontract ClickTheButton is Ownable {\n    uint constant COST = 10000 gwei;\n    using EnumerableMap for EnumerableMap.AddressToUintMap;\n\n    EnumerableMap.AddressToUintMap private timesClicked;\n\n    constructor() Ownable(msg.sender) {}\n\n    struct Clicker {\n        address user;\n        uint clicks;\n    }\n\n    function clickTheButton() public payable {\n        if(msg.value != COST) {\n            revert WrongValue();\n        }\n        (, uint clicks) = timesClicked.tryGet(msg.sender);\n        timesClicked.set(msg.sender, clicks+1);\n    }\n\n    function getMyClicks() public view returns (uint) {\n        (, uint clicks) = timesClicked.tryGet(msg.sender);\n        return clicks;\n    }\n\n    function getAllClicks() public view returns (Clicker[] memory) {\n        address[] memory keys = timesClicked.keys();\n        Clicker[] memory allClicks = new Clicker[](keys.length);\n\n        for(uint i = 0; i < keys.length; i++) {\n            address user = address(keys[i]);\n            allClicks[i] = Clicker(user, timesClicked.get(user));\n        }\n\n        return allClicks;\n    }\n\n    function withdraw() public onlyOwner {\n        payable(owner()).transfer(address(this).balance);\n    }\n}\n')),(0,r.yg)("hr",null))}d.isMDXComponent=!0}}]);