"use strict";(self.webpackChunk_app_base_docs=self.webpackChunk_app_base_docs||[]).push([[9506],{82247:(e,t,a)=>{a.d(t,{xA:()=>u,yg:()=>m});var n=a(14041);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(a),g=r,m=p["".concat(l,".").concat(g)]||p[g]||d[g]||i;return a?n.createElement(m,o(o({ref:t},u),{},{components:a})):n.createElement(m,o({ref:t},u))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},65251:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var n=a(89575),r=(a(14041),a(82247));const i={title:"Farcaster Frames: Gating content and creating redirects",slug:"/farcaster-frames-gating-and-redirects",description:"A tutorial that teaches how to create Frames with more advanced behaviors such as gating content based on a user's follows, likes, or recasts, and creating redirect buttons.",author:"briandoyle81",keywords:["farcaster","frames","farcaster frames"],tags:["frames"],difficulty:"intermediate",hide_table_of_contents:!1,displayed_sidebar:null},o=void 0,s={unversionedId:"docs/farcaster-frames-gating-and-redirects",id:"docs/farcaster-frames-gating-and-redirects",title:"Farcaster Frames: Gating content and creating redirects",description:"A tutorial that teaches how to create Frames with more advanced behaviors such as gating content based on a user's follows, likes, or recasts, and creating redirect buttons.",source:"@site/tutorials/docs/3_farcaster-frames-gating-and-redirects.md",sourceDirName:"docs",slug:"/farcaster-frames-gating-and-redirects",permalink:"/tutorials/farcaster-frames-gating-and-redirects",draft:!1,tags:[{label:"frames",permalink:"/tutorials/tags/frames"}],version:"current",sidebarPosition:3,frontMatter:{title:"Farcaster Frames: Gating content and creating redirects",slug:"/farcaster-frames-gating-and-redirects",description:"A tutorial that teaches how to create Frames with more advanced behaviors such as gating content based on a user's follows, likes, or recasts, and creating redirect buttons.",author:"briandoyle81",keywords:["farcaster","frames","farcaster frames"],tags:["frames"],difficulty:"intermediate",hide_table_of_contents:!1,displayed_sidebar:null}},l={},c=[{value:"Objectives",id:"objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Onchain App Development",id:"onchain-app-development",level:3},{value:"Vercel",id:"vercel",level:3},{value:"Farcaster",id:"farcaster",level:3},{value:"Frames",id:"frames",level:3},{value:"Setting Up a Copy of A Frame in 100 Lines",id:"setting-up-a-copy-of-a-frame-in-100-lines",level:2},{value:"Buttons and Images",id:"buttons-and-images",level:3},{value:"Text Entry",id:"text-entry",level:3},{value:"Link Button",id:"link-button",level:3},{value:"Redirect Button",id:"redirect-button",level:3},{value:"Creating Gates",id:"creating-gates",level:2},{value:"Like Gate",id:"like-gate",level:3},{value:"Follow and Recast Gates",id:"follow-and-recast-gates",level:3},{value:"Conclusion",id:"conclusion",level:2}],u={toc:c},p="wrapper";function d(e){let{components:t,...i}=e;return(0,r.yg)(p,(0,n.A)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"You can build complex and exciting ",(0,r.yg)("a",{parentName:"p",href:"https://warpcast.notion.site/Farcaster-Frames-4bd47fe97dc74a42a48d3a234636d8c5"},"Frames")," on ",(0,r.yg)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," that meet the community's expectation for new and exciting things to do. ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit"),", and our ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/Zizzamia/a-frame-in-100-lines"},"a-frame-in-100-lines")," demo give you a number of tools to build complex interactions within a frame."),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"objectives"},"Objectives"),(0,r.yg)("p",null,"By the end of this tutorial, you should be able to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Build a ",(0,r.yg)("a",{parentName:"li",href:"https://www.farcaster.xyz/"},"Farcaster")," Frame that gates content behind a requirement that the user follows, recasts, or likes you or your frame"),(0,r.yg)("li",{parentName:"ul"},"Create frames that use the text field and extract it from the message"),(0,r.yg)("li",{parentName:"ul"},"Construct redirect buttons in Frames"),(0,r.yg)("li",{parentName:"ul"},"Create multiple paths within a Frame based on the button clicked by a user")),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.yg)("h3",{id:"onchain-app-development"},"Onchain App Development"),(0,r.yg)("p",null,"You'll need to be comfortable building onchain apps."),(0,r.yg)("h3",{id:"vercel"},"Vercel"),(0,r.yg)("p",null,"You'll need to be comfortable deploying your app to ",(0,r.yg)("a",{parentName:"p",href:"https://vercel.com"},"Vercel"),", or using another solution on your own. Check out our tutorial on ",(0,r.yg)("a",{parentName:"p",href:"/tutorials/farcaster-frames-deploy-to-vercel"},"deploying with Vercel")," if you need a refresher!"),(0,r.yg)("h3",{id:"farcaster"},"Farcaster"),(0,r.yg)("p",null,"You must have a ",(0,r.yg)("a",{parentName:"p",href:"https://www.farcaster.xyz/"},"Farcaster")," account with a connected wallet. Check out the ",(0,r.yg)("a",{parentName:"p",href:"https://warpcast.com/~/channel/base"},"Base channel")," to stay in the loop when we release tutorials like this!"),(0,r.yg)("h3",{id:"frames"},"Frames"),(0,r.yg)("p",null,"You should be comfortable with the basics of creating Farcaster ",(0,r.yg)("a",{parentName:"p",href:"https://warpcast.notion.site/Farcaster-Frames-4bd47fe97dc74a42a48d3a234636d8c5"},"Frames"),". If you aren't, check out our tutorial on ",(0,r.yg)("a",{parentName:"p",href:"/tutorials/farcaster-frames-nft-minting"},"NFT Minting Frame"),"."),(0,r.yg)("hr",null),(0,r.yg)("h2",{id:"setting-up-a-copy-of-a-frame-in-100-lines"},"Setting Up a Copy of A Frame in 100 Lines"),(0,r.yg)("p",null,"Create a new repo using ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/Zizzamia/a-frame-in-100-lines"},"a-frame-in-100-lines")," as a template."),(0,r.yg)("p",null,"Add your new repo to Vercel and deploy. If you need a refresher, check out ",(0,r.yg)("a",{parentName:"p",href:"/tutorials/farcaster-frames-deploy-to-vercel"},"deploying with Vercel"),". Open the ",(0,r.yg)("a",{parentName:"p",href:"https://warpcast.com/~/developers/frames"},"Frame Validator")," and test the current version of the template."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"100 Lines",src:a(43855).A,width:"1024",height:"636"})),(0,r.yg)("p",null,"The demo has examples of most of the features available for your frames."),(0,r.yg)("h3",{id:"buttons-and-images"},"Buttons and Images"),(0,r.yg)("p",null,"The core functionality of a frame is an image and at least 1 button. Buttons can do a number of things, including requesting a new frame to replace the current one, opening a transaction for the user to consider approving, or opening a link to a website."),(0,r.yg)("h3",{id:"text-entry"},"Text Entry"),(0,r.yg)("p",null,"Optionally, frames can include a text entry field. Try it out! When you click the ",(0,r.yg)("inlineCode",{parentName:"p"},"Story Time!")," button, the text will be preserved, and will appear in the button on the next frame."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Story Time",src:a(11471).A,width:"1024",height:"374"})),(0,r.yg)("p",null,"The text input field is created by adding the ",(0,r.yg)("inlineCode",{parentName:"p"},"input")," property to ",(0,r.yg)("inlineCode",{parentName:"p"},"getFrameMetadata"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"const frameMetadata = getFrameMetadata({\n  buttons: [\n    {\n      label: 'Story time',\n    },\n    {\n      action: 'tx',\n      label: 'Send Base Sepolia',\n      target: `${NEXT_PUBLIC_URL}/api/tx`,\n      postUrl: `${NEXT_PUBLIC_URL}/api/tx-success`,\n    },\n  ],\n  image: {\n    src: `${NEXT_PUBLIC_URL}/park-3.png`,\n    aspectRatio: '1:1',\n  },\n  input: {\n    text: 'Tell me a story',\n  },\n  postUrl: `${NEXT_PUBLIC_URL}/api/frame`,\n});\n")),(0,r.yg)("p",null,"When the user enters the text, it gets included in the frame message. You can see how it is retrieved in ",(0,r.yg)("inlineCode",{parentName:"p"},"api/frame/route.ts"),". The ",(0,r.yg)("inlineCode",{parentName:"p"},"getFrameMessageBody")," function extracts the frame message from the request, and validates it. The returned ",(0,r.yg)("inlineCode",{parentName:"p"},"message")," contains a number of useful properties that can be seen where it is defined in ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit"),", in ",(0,r.yg)("inlineCode",{parentName:"p"},"src/frame/types.ts"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"export interface FrameValidationData {\n  address: string | null; // The connected wallet address of the interacting user.\n  button: number; // Number of the button clicked\n  following: boolean; // Indicates if the viewer clicking the frame follows the cast author\n  input: string; // Text input from the viewer typing in the frame\n  interactor: {\n    fid: number; // Viewer Farcaster ID\n    custody_address: string; // Viewer custody address\n    verified_accounts: string[]; // Viewer account addresses\n    verified_addresses: {\n      eth_addresses: string[] | null;\n      sol_addresses: string[] | null;\n    };\n  };\n  liked: boolean; // Indicates if the viewer clicking the frame liked the cast\n  raw: NeynarFrameValidationInternalModel;\n  recasted: boolean; // Indicates if the viewer clicking the frame recasted the cast\n  state: {\n    serialized: string; // Serialized state (e.g. JSON) passed to the frame server\n  };\n  transaction: {\n    hash: string;\n  } | null;\n  valid: boolean; // Indicates if the frame is valid\n}\n")),(0,r.yg)("p",null,"The demo doesn't make use of the ",(0,r.yg)("inlineCode",{parentName:"p"},"input")," property, but it does extract the text:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"//api/frames/route.ts\n\n// Extract the input:\nconst text = message.input || '';\n")),(0,r.yg)("h3",{id:"link-button"},"Link Button"),(0,r.yg)("p",null,"You can now add outbound links to buttons. To do this with ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit"),", simply create a button with an ",(0,r.yg)("inlineCode",{parentName:"p"},"action")," property of ",(0,r.yg)("inlineCode",{parentName:"p"},"link"),", and a ",(0,r.yg)("inlineCode",{parentName:"p"},"target")," of the desired url:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"{\n  action: 'link',\n  label: 'Link to Google',\n  target: 'https://www.google.com',\n},\n")),(0,r.yg)("h3",{id:"redirect-button"},"Redirect Button"),(0,r.yg)("p",null,"You can also do a redirect with a button. The example has one on the second frame - ",(0,r.yg)("inlineCode",{parentName:"p"},"Dog pictures \u2197"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"{\n  action: 'post_redirect',\n  label: 'Dog pictures',\n},\n")),(0,r.yg)("p",null,"The way it works is a little tricky."),(0,r.yg)("p",null,"Clicking this button hits the ",(0,r.yg)("inlineCode",{parentName:"p"},"postUrl"),", with the requirement that you return a ",(0,r.yg)("inlineCode",{parentName:"p"},"redirect")," response with a status of 302, and a link. You can see that in ",(0,r.yg)("inlineCode",{parentName:"p"},"route.ts"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"if (message?.button === 3) {\n  return NextResponse.redirect(\n    'https://www.google.com/search?q=cute+dog+pictures&tbm=isch&source=lnms',\n    { status: 302 },\n  );\n}\n")),(0,r.yg)("p",null,"Try changing it to your favorite link!"),(0,r.yg)("h2",{id:"creating-gates"},"Creating Gates"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"message"),", shown above, has properties that make it easy to design interactions based on whether or not the user interacting with the frame has liked or recast your post, or if they follow the original caster."),(0,r.yg)("p",null,"!!!caution"),(0,r.yg)("p",null,'The community is evolving quickly and many people are fatigued with "Like, follow, recast" spam in their feeds. These are useful tools, but some consideration should be given for designing an experience for the current culture of the community you are trying to reach.'),(0,r.yg)("p",null,"!!!"),(0,r.yg)("h3",{id:"like-gate"},"Like Gate"),(0,r.yg)("p",null,'To require the user to "like" the cast before seeing images of puppies, simply modify the conditional for the redirect to include that check:'),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"if (message?.button === 3 && message?.liked) {\n  return NextResponse.redirect(\n    'https://www.google.com/search?q=cute+dog+pictures&tbm=isch&source=lnms',\n    { status: 302 },\n  );\n}\n")),(0,r.yg)("p",null,"If they haven't, return a version of the original frame with a new message in the third button. In doing so, you've created a loop with a behavior condition for the user to exit:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-tsx"},"if (message?.button === 3 && message.liked) {\n  return NextResponse.redirect(\n    'https://www.google.com/search?q=cute+dog+pictures&tbm=isch&source=lnms',\n    { status: 302 },\n  );\n} else if (message?.button === 3) {\n  return new NextResponse(\n    getFrameHtmlResponse({\n      buttons: [\n        {\n          label: `State: ${state?.page || 0}`,\n        },\n        {\n          action: 'link',\n          label: 'OnchainKit',\n          target: 'https://onchainkit.xyz',\n        },\n        {\n          action: 'post_redirect',\n          label: 'Like to see doggos!',\n        },\n      ],\n      image: {\n        src: `${NEXT_PUBLIC_URL}/park-1.png`,\n      },\n      postUrl: `${NEXT_PUBLIC_URL}/api/frame`,\n      state: {\n        page: state?.page + 1,\n        time: new Date().toISOString(),\n      },\n    }),\n  );\n}\n")),(0,r.yg)("p",null,"Note that we're returning a ",(0,r.yg)("inlineCode",{parentName:"p"},"getFrameHtmlResponse")," here, ",(0,r.yg)("strong",{parentName:"p"},"not")," a ",(0,r.yg)("inlineCode",{parentName:"p"},"getFrameMetadata"),". That's only used for the initial frame created from a page!"),(0,r.yg)("h3",{id:"follow-and-recast-gates"},"Follow and Recast Gates"),(0,r.yg)("p",null,'On your own, try changing the "like" gate to require the user to follow you, recast, or all three!'),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},(0,r.yg)("strong",{parentName:"p"},"Hint:")," Take a close look at the ",(0,r.yg)("inlineCode",{parentName:"p"},"FrameValidationData")," properties. ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit")," makes this easy!")),(0,r.yg)("h2",{id:"conclusion"},"Conclusion"),(0,r.yg)("p",null,"In this tutorial, you learned how to use the main features of Frames - text input, link buttons, and redirects. You also learned how to use new features in ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/coinbase/onchainkit"},"OnchainKit")," to require your users to perform certain actions to unlock features in your Frame. Finally, you learned how to create a loop in your Frame's behavior, which can be used to create very complicated Frames!"),(0,r.yg)("hr",null))}d.isMDXComponent=!0},11471:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/story-time-d150a6bd722cc71ba41ad7bb799a5e7e.png"},43855:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/updated-100-lines-ce333f5e36f5cfe8dddd43f15d3d8383.png"}}]);